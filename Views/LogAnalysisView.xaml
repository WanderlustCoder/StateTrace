<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

  <Grid Background="{DynamicResource Theme.Surface.Primary}">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Top Toolbar: Import and Format -->
    <Border Grid.Row="0" BorderBrush="{DynamicResource Theme.Border.Primary}" BorderThickness="0,0,0,1" Padding="10">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Orientation="Horizontal">
          <Button Name="ImportFileButton" Content="Import File" Width="90" Margin="0,0,5,0"
                  Style="{DynamicResource PrimaryButtonStyle}" ToolTip="Import log file"/>
          <Button Name="PasteLogsButton" Content="Paste Logs" Width="85" Margin="0,0,10,0"
                  Style="{DynamicResource SecondaryButtonStyle}" ToolTip="Paste log entries from clipboard"/>
          <Label Content="Format:" Style="{DynamicResource ToolbarLabelStyle}" VerticalAlignment="Center"/>
          <ComboBox Name="FormatDropdown" Width="100" Margin="5,0"
                    Style="{DynamicResource ToolbarComboBoxStyle}">
            <ComboBoxItem Content="Auto-detect" IsSelected="True"/>
            <ComboBoxItem Content="Cisco IOS"/>
            <ComboBoxItem Content="Arista EOS"/>
            <ComboBoxItem Content="RFC 5424"/>
            <ComboBoxItem Content="RFC 3164"/>
            <ComboBoxItem Content="Generic"/>
          </ComboBox>
          <Label Content="Hostname:" Style="{DynamicResource ToolbarLabelStyle}" VerticalAlignment="Center" Margin="10,0,0,0"/>
          <TextBox Name="DefaultHostnameBox" Width="100" Margin="5,0"
                   Background="{DynamicResource Theme.Input.Background}"
                   Foreground="{DynamicResource Theme.Input.Text}"
                   BorderBrush="{DynamicResource Theme.Input.Border}"
                   ToolTip="Default hostname for logs without device name"/>
        </StackPanel>

        <StackPanel Grid.Column="2" Orientation="Horizontal">
          <Button Name="ClearLogsButton" Content="Clear" Width="60" Margin="5,0"
                  Style="{DynamicResource SecondaryButtonStyle}" ToolTip="Clear all imported logs"/>
          <Button Name="AnalyzeButton" Content="Analyze" Width="70"
                  Style="{DynamicResource PrimaryButtonStyle}" ToolTip="Run pattern detection"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Summary Bar -->
    <Border Grid.Row="1" Background="{DynamicResource Theme.Surface.Secondary}" Padding="10,5">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Orientation="Horizontal">
          <TextBlock Name="SummaryText" Text="No logs loaded" FontWeight="SemiBold"
                     Foreground="{DynamicResource Theme.Text.Primary}" VerticalAlignment="Center"/>
        </StackPanel>

        <StackPanel Grid.Column="2" Orientation="Horizontal">
          <Border Background="{DynamicResource Theme.Danger}" CornerRadius="3" Padding="8,2" Margin="5,0">
            <TextBlock Name="CriticalCount" Text="0 Critical" Foreground="White" FontSize="11"/>
          </Border>
          <Border Background="{DynamicResource Theme.Warning}" CornerRadius="3" Padding="8,2" Margin="5,0">
            <TextBlock Name="WarningCount" Text="0 Warning" Foreground="White" FontSize="11"/>
          </Border>
          <Border Background="{DynamicResource Theme.Info}" CornerRadius="3" Padding="8,2" Margin="5,0">
            <TextBlock Name="NoticeCount" Text="0 Notice" Foreground="White" FontSize="11"/>
          </Border>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Main Content Area -->
    <Grid Grid.Row="2" Margin="10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="280"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Left Panel: Patterns and Search -->
      <Border Grid.Column="0" BorderBrush="{DynamicResource Theme.Border.Primary}" BorderThickness="0,0,1,0" Padding="0,0,10,0">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="150"/>
          </Grid.RowDefinitions>

          <!-- Patterns Header -->
          <StackPanel Grid.Row="0">
            <Label Content="Detected Patterns" Style="{DynamicResource ToolbarLabelStyle}"
                   FontWeight="Bold" FontSize="14"/>
          </StackPanel>

          <!-- Patterns List -->
          <ListBox Name="PatternListBox" Grid.Row="1" Margin="0,5,0,10"
                   Background="{DynamicResource Theme.Input.Background}"
                   Foreground="{DynamicResource Theme.Input.Text}"
                   BorderBrush="{DynamicResource Theme.Input.Border}"
                   VirtualizingPanel.IsVirtualizing="True" VirtualizingPanel.VirtualizationMode="Recycling"
                   ScrollViewer.CanContentScroll="True">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Grid Margin="5">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                  </Grid.ColumnDefinitions>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>

                  <Ellipse Grid.Column="0" Grid.RowSpan="2" Width="10" Height="10" Margin="0,0,8,0"
                           VerticalAlignment="Center" Fill="{Binding SeverityColor}"/>
                  <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding PatternName}" FontWeight="SemiBold"/>
                  <TextBlock Grid.Column="1" Grid.Row="1" FontSize="11" Opacity="0.7">
                    <Run Text="{Binding MatchCount}"/>
                    <Run Text=" matches"/>
                  </TextBlock>
                </Grid>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>

          <!-- Search Header -->
          <StackPanel Grid.Row="2">
            <Label Content="Search &amp; Filter" Style="{DynamicResource ToolbarLabelStyle}"
                   FontWeight="Bold" FontSize="13"/>
          </StackPanel>

          <!-- Search Panel -->
          <StackPanel Grid.Row="3" Margin="0,5,0,0">
            <TextBox Name="SearchKeywordBox" Margin="0,0,0,5"
                     Background="{DynamicResource Theme.Input.Background}"
                     Foreground="{DynamicResource Theme.Input.Text}"
                     BorderBrush="{DynamicResource Theme.Input.Border}">
              <TextBox.Style>
                <Style TargetType="TextBox">
                  <Style.Triggers>
                    <Trigger Property="Text" Value="">
                      <Setter Property="Tag" Value="Search logs..."/>
                    </Trigger>
                  </Style.Triggers>
                </Style>
              </TextBox.Style>
            </TextBox>

            <Grid Margin="0,0,0,5">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>
              <ComboBox Name="SeverityFilterDropdown" Grid.Column="0" Margin="0,0,2,0"
                        Style="{DynamicResource ToolbarComboBoxStyle}">
                <ComboBoxItem Content="All Severities" IsSelected="True"/>
                <ComboBoxItem Content="Critical (0-2)"/>
                <ComboBoxItem Content="Error (3)"/>
                <ComboBoxItem Content="Warning (4)"/>
                <ComboBoxItem Content="Notice (5)"/>
                <ComboBoxItem Content="Info (6-7)"/>
              </ComboBox>
              <ComboBox Name="DeviceFilterDropdown" Grid.Column="1" Margin="2,0,0,0"
                        Style="{DynamicResource ToolbarComboBoxStyle}">
                <ComboBoxItem Content="All Devices" IsSelected="True"/>
              </ComboBox>
            </Grid>

            <Button Name="SearchButton" Content="Search" Style="{DynamicResource PrimaryButtonStyle}"
                    Margin="0,5,0,0"/>
          </StackPanel>
        </Grid>
      </Border>

      <!-- Right Panel: Log Entries -->
      <Grid Grid.Column="1" Margin="10,0,0,0">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Log Entries Header -->
        <Grid Grid.Row="0" Margin="0,0,0,5">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <StackPanel Grid.Column="0" Orientation="Horizontal">
            <Label Content="Log Entries" Style="{DynamicResource ToolbarLabelStyle}"
                   FontWeight="Bold" FontSize="14"/>
            <TextBlock Name="EntryCountText" Text="(0 entries)" VerticalAlignment="Center"
                       Foreground="{DynamicResource Theme.Text.Secondary}" Margin="5,0,0,0"/>
          </StackPanel>

          <StackPanel Grid.Column="1" Orientation="Horizontal">
            <Button Name="ExportButton" Content="Export" Width="60" Margin="5,0"
                    Style="{DynamicResource SecondaryButtonStyle}" ToolTip="Export filtered results"/>
            <Button Name="CopySelectedButton" Content="Copy" Width="50"
                    Style="{DynamicResource SecondaryButtonStyle}" ToolTip="Copy selected entries"/>
          </StackPanel>
        </Grid>

        <!-- Log Entries DataGrid -->
        <Grid Grid.Row="1">
          <DataGrid Name="LogEntriesGrid"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    SelectionMode="Extended"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    Background="{DynamicResource Theme.Input.Background}"
                    Foreground="{DynamicResource Theme.Input.Text}"
                    BorderBrush="{DynamicResource Theme.Input.Border}"
                    RowBackground="{DynamicResource Theme.Surface.Primary}"
                    AlternatingRowBackground="{DynamicResource Theme.Surface.Secondary}"
                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                    ScrollViewer.HorizontalScrollBarVisibility="Auto"
                    ScrollViewer.IsDeferredScrollingEnabled="True"
                    VirtualizingPanel.IsVirtualizing="True"
                    VirtualizingPanel.VirtualizationMode="Recycling"
                    EnableRowVirtualization="True" EnableColumnVirtualization="True"
                    ScrollViewer.CanContentScroll="True"
                    VirtualizingPanel.ScrollUnit="Pixel">
            <DataGrid.Columns>
              <DataGridTextColumn Header="Time" Binding="{Binding TimestampString}" Width="120"/>
              <DataGridTextColumn Header="Sev" Binding="{Binding Severity}" Width="35"/>
              <DataGridTextColumn Header="Device" Binding="{Binding Hostname}" Width="100"/>
              <DataGridTextColumn Header="Facility" Binding="{Binding Facility}" Width="80"/>
              <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*"/>
            </DataGrid.Columns>
          </DataGrid>

          <Border Name="LogsEmptyStatePanel" HorizontalAlignment="Center" VerticalAlignment="Center"
                  Background="{DynamicResource Theme.Surface.Secondary}" Padding="30,20" CornerRadius="8"
                  Visibility="Visible">
            <StackPanel>
              <TextBlock Text="No Logs Loaded" FontSize="18" FontWeight="Bold"
                         Foreground="{DynamicResource Theme.Text.Primary}" HorizontalAlignment="Center"/>
              <TextBlock Text="Import a log file or paste log entries to get started"
                         Foreground="{DynamicResource Theme.Text.Muted}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
            </StackPanel>
          </Border>

          <Border Name="LogsLoadingIndicator" Style="{DynamicResource LoadingIndicatorStyle}">
            <StackPanel>
              <TextBlock Text="Parsing logs..." Style="{DynamicResource LoadingTextStyle}"/>
              <ProgressBar Style="{DynamicResource LoadingProgressStyle}"/>
            </StackPanel>
          </Border>
        </Grid>

        <!-- Selected Entry Details -->
        <Border Grid.Row="2" Margin="0,10,0,0" Padding="10"
                Background="{DynamicResource Theme.Surface.Secondary}"
                BorderBrush="{DynamicResource Theme.Border.Primary}" BorderThickness="1" CornerRadius="4"
                Visibility="Collapsed" Name="DetailsPanel">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Name="DetailsTitleText" FontWeight="Bold"
                       Foreground="{DynamicResource Theme.Text.Primary}"/>
            <TextBox Grid.Row="1" Name="DetailsContentBox" Margin="0,5,0,0"
                     TextWrapping="Wrap" IsReadOnly="True" BorderThickness="0"
                     Background="Transparent" Foreground="{DynamicResource Theme.Text.Primary}"
                     MaxHeight="80" VerticalScrollBarVisibility="Auto"/>
          </Grid>
        </Border>
      </Grid>
    </Grid>

    <!-- Bottom Status Bar -->
    <Border Grid.Row="3" Background="{DynamicResource Theme.Toolbar.Background}" Padding="10,5">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <TextBlock Name="StatusText" Grid.Column="0" Text="Ready"
                   Foreground="{DynamicResource Theme.Text.Secondary}" VerticalAlignment="Center"/>

        <StackPanel Grid.Column="1" Orientation="Horizontal">
          <TextBlock Name="TimeRangeText" Text="" Foreground="{DynamicResource Theme.Text.Secondary}"
                     VerticalAlignment="Center" Margin="0,0,10,0"/>
          <TextBlock Name="FormatText" Text="" Foreground="{DynamicResource Theme.Text.Secondary}"
                     VerticalAlignment="Center"/>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>
