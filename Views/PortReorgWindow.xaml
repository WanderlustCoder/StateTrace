<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Port Reorg" Height="720" Width="1180"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource Theme.Window.Background}">

  <Grid Background="{DynamicResource Theme.Surface.Secondary}" TextElement.Foreground="{DynamicResource Theme.Text.Primary}" Margin="10">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="240"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="280"/>
    </Grid.RowDefinitions>

    <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,10">
      <TextBlock Text="Hostname:" Margin="0,0,6,0" VerticalAlignment="Center"/>
      <TextBlock Name="ReorgHostnameText" FontWeight="Bold" Margin="0,0,18,0" VerticalAlignment="Center"/>
      <TextBlock Text="Vendor:" Margin="0,0,6,0" VerticalAlignment="Center"/>
      <TextBlock Name="ReorgVendorText" FontWeight="Bold" Margin="0,0,18,0" VerticalAlignment="Center"/>

      <CheckBox Name="ReorgChunkBy12CheckBox"
                Content="Chunk by 12 ports"
                IsChecked="True"
                Margin="0,0,18,0"
                VerticalAlignment="Center"
                ToolTip="When enabled, generated scripts are grouped into numbered blocks of N ports for easier review."/>

      <TextBlock Text="Chunk size:" Margin="0,0,6,0" VerticalAlignment="Center"/>
      <TextBox Name="ReorgChunkSizeBox"
               Width="40"
               Text="12"
               Margin="0,0,18,0"
               Background="{DynamicResource Theme.Input.Background}"
               Foreground="{DynamicResource Theme.Input.Text}"
               BorderBrush="{DynamicResource Theme.Input.Border}"
               BorderThickness="1"/>

      <CheckBox Name="ReorgPagedViewCheckBox"
                Content="Paged view (12 ports)"
                IsChecked="False"
                Margin="0,0,10,0"
                VerticalAlignment="Center"
                ToolTip="When enabled, ports are shown in 12-port pages. Use Parking to move profiles between pages."/>

      <Button Name="ReorgPagePrevButton"
              Content="Prev"
              Width="55"
              Margin="0,0,5,0"
              VerticalAlignment="Center"
              Style="{DynamicResource SecondaryButtonStyle}"/>

      <ComboBox Name="ReorgPageComboBox"
                Width="200"
                Margin="0,0,5,0"
                VerticalAlignment="Center"
                Style="{DynamicResource ToolbarComboBoxStyle}"/>

      <Button Name="ReorgPageNextButton"
              Content="Next"
              Width="55"
              Margin="0,0,18,0"
              VerticalAlignment="Center"
              Style="{DynamicResource SecondaryButtonStyle}"/>

      <TextBlock Name="ReorgPageInfoText" Margin="0,0,10,0" VerticalAlignment="Center"/>

      <TextBlock Text="Size:" Margin="0,0,4,0" VerticalAlignment="Center"/>
      <TextBox Name="ReorgPageSizeBox"
               Width="40"
               Text="12"
               Margin="0,0,10,0"
               VerticalAlignment="Center"
               ToolTip="Page size (1-96). Press Enter to apply."
               Background="{DynamicResource Theme.Input.Background}"
               Foreground="{DynamicResource Theme.Input.Text}"
               BorderBrush="{DynamicResource Theme.Input.Border}"
               BorderThickness="1"/>

      <TextBlock Text="Jump:" Margin="0,0,4,0" VerticalAlignment="Center"/>
      <TextBox Name="ReorgQuickJumpBox"
               Width="100"
               Margin="0,0,10,0"
               VerticalAlignment="Center"
               ToolTip="Type port name and press Enter to jump to that page"
               Background="{DynamicResource Theme.Input.Background}"
               Foreground="{DynamicResource Theme.Input.Text}"
               BorderBrush="{DynamicResource Theme.Input.Border}"
               BorderThickness="1"/>

      <TextBlock Text="Search:" Margin="0,0,4,0" VerticalAlignment="Center"/>
      <TextBox Name="ReorgSearchBox"
               Width="120"
               Margin="0,0,4,0"
               VerticalAlignment="Center"
               ToolTip="Search labels (live filter, highlights matches)"
               Background="{DynamicResource Theme.Input.Background}"
               Foreground="{DynamicResource Theme.Input.Text}"
               BorderBrush="{DynamicResource Theme.Input.Border}"
               BorderThickness="1"/>

      <Button Name="ReorgSearchClearButton"
              Content="X"
              Width="22"
              Margin="0,0,18,0"
              VerticalAlignment="Center"
              ToolTip="Clear search"
              Style="{DynamicResource SecondaryButtonStyle}"/>

      <TextBlock Name="ReorgStatusText" VerticalAlignment="Center" Foreground="{DynamicResource Theme.Status.Warning}"/>
    </StackPanel>

     <GroupBox Grid.Row="1" Grid.Column="0" Header="Parking" Margin="0,0,10,0">
       <ListBox Name="ReorgParkingList"
                AllowDrop="True"
                Background="{DynamicResource Theme.DataGrid.Background}"
                BorderBrush="Black"
                BorderThickness="1"
                HorizontalContentAlignment="Stretch"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                ToolTip="Drag labels here to park/unassign them (also useful for cross-page moves). Drag parked labels onto ports to assign.">
       <ListBox.ItemTemplate>
          <DataTemplate>
             <Border Padding="6,2"
                     Margin="0,1"
                     CornerRadius="4"
                     Background="{DynamicResource Theme.Template.Red}"
                     BorderBrush="Black"
                     BorderThickness="1"
                     Cursor="Hand">
               <Grid>
                 <Grid.ColumnDefinitions>
                   <ColumnDefinition Width="*"/>
                   <ColumnDefinition Width="Auto"/>
                 </Grid.ColumnDefinitions>
                 <TextBlock Grid.Column="0"
                            Text="{Binding Label}"
                            TextTrimming="CharacterEllipsis"
                            Foreground="{DynamicResource Theme.DataGrid.HeaderText}">
                   <TextBlock.Style>
                     <Style TargetType="TextBlock">
                       <Style.Triggers>
                         <DataTrigger Binding="{Binding Label}" Value="">
                           <Setter Property="Text" Value="(blank)"/>
                           <Setter Property="Opacity" Value="0.7"/>
                         </DataTrigger>
                       </Style.Triggers>
                     </Style>
                   </TextBlock.Style>
                 </TextBlock>
                 <TextBlock Grid.Column="1"
                            Text="{Binding SourcePort}"
                            Margin="10,0,0,0"
                            Opacity="0.75"
                            Foreground="{DynamicResource Theme.DataGrid.HeaderText}"/>
               </Grid>
             </Border>
           </DataTemplate>
         </ListBox.ItemTemplate>
       </ListBox>
     </GroupBox>

     <DataGrid Name="ReorgGrid"
               Grid.Row="1"
               Grid.Column="1"
               AutoGenerateColumns="False"
               CanUserAddRows="False"
               AllowDrop="True"
               CanUserSortColumns="False"
               CanUserReorderColumns="False"
                SelectionMode="Extended"
                SelectionUnit="FullRow"
                ToolTip="Drag a label block onto another port to move it; the displaced label goes to Parking. Hold Shift to swap FromPort + label. When paging is enabled, use Parking for cross-page moves. Right-click for more options."
                Style="{DynamicResource PrimaryDataGridStyle}"
               ScrollViewer.VerticalScrollBarVisibility="Auto"
               ScrollViewer.HorizontalScrollBarVisibility="Auto"
              VirtualizingPanel.IsVirtualizing="True"
              VirtualizingPanel.VirtualizationMode="Recycling"
              EnableRowVirtualization="True"
              EnableColumnVirtualization="True">
      <DataGrid.ContextMenu>
        <ContextMenu Name="ReorgGridContextMenu"
                     Background="{DynamicResource Theme.Surface.Primary}"
                     Foreground="{DynamicResource Theme.Text.Primary}">
          <MenuItem Name="ReorgMoveToMenuItem" Header="Move To..."/>
          <Separator/>
          <MenuItem Name="ReorgClearLabelMenuItem" Header="Clear Label (Park)"/>
          <MenuItem Name="ReorgSwapLabelsMenuItem" Header="Swap Labels"/>
        </ContextMenu>
      </DataGrid.ContextMenu>
      <!-- ST-D-012: Row style for module boundaries and search highlights -->
      <DataGrid.RowStyle>
        <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
          <Setter Property="BorderThickness" Value="0"/>
          <Setter Property="BorderBrush" Value="{DynamicResource Theme.Input.Border}"/>
          <Style.Triggers>
            <!-- Module boundary: thick top border -->
            <DataTrigger Binding="{Binding IsModuleBoundary}" Value="True">
              <Setter Property="BorderThickness" Value="0,2,0,0"/>
              <Setter Property="BorderBrush" Value="{DynamicResource Theme.Text.Secondary}"/>
            </DataTrigger>
            <!-- Search match: highlight background -->
            <DataTrigger Binding="{Binding IsSearchMatch}" Value="True">
              <Setter Property="Background" Value="{DynamicResource Theme.Template.Yellow}"/>
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </DataGrid.RowStyle>
      <DataGrid.Columns>
        <DataGridTextColumn Header="Port" IsReadOnly="True" Width="120" Binding="{Binding TargetPort}"/>
        <DataGridTemplateColumn Header="Label" Width="260">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <Border Padding="6,2"
                      Margin="0,1"
                      CornerRadius="4"
                      BorderBrush="{DynamicResource Theme.Input.Border}"
                      BorderThickness="1"
                      Cursor="Hand">
                <Border.Style>
                  <Style TargetType="Border">
                    <Setter Property="Background" Value="{DynamicResource Theme.Surface.Primary}"/>
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding LabelState}" Value="Parked">
                        <Setter Property="Background" Value="{DynamicResource Theme.Template.Red}"/>
                      </DataTrigger>
                      <DataTrigger Binding="{Binding LabelState}" Value="Changed">
                        <Setter Property="Background" Value="{DynamicResource Theme.Template.Green}"/>
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Border.Style>
                <TextBlock Text="{Binding NewLabel}"
                           TextTrimming="CharacterEllipsis"
                           Foreground="{DynamicResource Theme.DataGrid.HeaderText}">
                  <TextBlock.Style>
                    <Style TargetType="TextBlock">
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding NewLabel}" Value="">
                          <Setter Property="Text" Value="(blank)"/>
                          <Setter Property="Opacity" Value="0.7"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </TextBlock.Style>
                </TextBlock>
              </Border>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
          <DataGridTemplateColumn.CellEditingTemplate>
            <DataTemplate>
              <TextBox Text="{Binding NewLabel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                       Background="{DynamicResource Theme.Input.Background}"
                       Foreground="{DynamicResource Theme.Input.Text}"
                       BorderBrush="{DynamicResource Theme.Input.Border}"
                       BorderThickness="1"/>
            </DataTemplate>
          </DataGridTemplateColumn.CellEditingTemplate>
        </DataGridTemplateColumn>
        <DataGridTextColumn Header="FromPort" IsReadOnly="True" Width="120" Binding="{Binding SourcePort}"/>
        <DataGridTextColumn Header="OriginalLabel" IsReadOnly="True" Width="240" Binding="{Binding CurrentLabel}"/>
      </DataGrid.Columns>
    </DataGrid>

    <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,10,0,10">
      <Button Name="ReorgUndoButton" Content="Undo" Width="70" Margin="0,0,5,0" Style="{DynamicResource SecondaryButtonStyle}" ToolTip="Undo last change (Ctrl+Z)"/>
      <Button Name="ReorgRedoButton" Content="Redo" Width="70" Margin="0,0,10,0" Style="{DynamicResource SecondaryButtonStyle}" ToolTip="Redo last undone change (Ctrl+Y)"/>

      <Button Name="ReorgSuggestButton" Content="Suggest" Width="90" Margin="0,0,10,0" Style="{DynamicResource PrimaryButtonStyle}"/>
      <Button Name="ReorgResetButton" Content="Reset" Width="70" Margin="0,0,10,0" Style="{DynamicResource PrimaryButtonStyle}"/>
      <Button Name="ReorgGenerateButton" Content="Generate" Width="90" Margin="0,0,10,0" Style="{DynamicResource PrimaryButtonStyle}"/>

      <Button Name="ReorgSelectPageButton" Content="Select Page" Width="90" Margin="0,0,5,0" Style="{DynamicResource SecondaryButtonStyle}" ToolTip="Select all ports on current page"/>
      <Button Name="ReorgClearPageButton" Content="Clear Page" Width="90" Margin="0,0,10,0" Style="{DynamicResource SecondaryButtonStyle}" ToolTip="Park all labels on current page"/>

      <Button Name="ReorgCopyChangeButton" Content="Copy Change" Width="100" Margin="0,0,5,0" Style="{DynamicResource PrimaryButtonStyle}"/>
      <Button Name="ReorgCopyRollbackButton" Content="Copy Rollback" Width="110" Margin="0,0,10,0" Style="{DynamicResource PrimaryButtonStyle}"/>

      <Button Name="ReorgSaveChangeButton" Content="Save..." Width="70" Margin="0,0,5,0" Style="{DynamicResource PrimaryButtonStyle}"/>
      <Button Name="ReorgSaveRollbackButton" Content="Save RB..." Width="80" Margin="0,0,10,0" Style="{DynamicResource PrimaryButtonStyle}"/>

      <Button Name="ReorgCloseButton" Content="Close" Width="70" Style="{DynamicResource PrimaryButtonStyle}"/>
    </StackPanel>

    <TabControl Grid.Row="3" Grid.ColumnSpan="2">
      <TabItem Header="Change Script">
        <TextBox Name="ReorgChangeScriptBox"
                 Margin="5"
                 IsReadOnly="True"
                 TextWrapping="NoWrap"
                 VerticalScrollBarVisibility="Auto"
                 HorizontalScrollBarVisibility="Auto"
                 Background="{DynamicResource Theme.Input.Background}"
                 Foreground="{DynamicResource Theme.Input.Text}"
                 BorderBrush="{DynamicResource Theme.Input.Border}"
                 BorderThickness="1"/>
      </TabItem>
      <TabItem Header="Rollback Script">
        <TextBox Name="ReorgRollbackScriptBox"
                 Margin="5"
                 IsReadOnly="True"
                 TextWrapping="NoWrap"
                 VerticalScrollBarVisibility="Auto"
                 HorizontalScrollBarVisibility="Auto"
                 Background="{DynamicResource Theme.Input.Background}"
                 Foreground="{DynamicResource Theme.Input.Text}"
                 BorderBrush="{DynamicResource Theme.Input.Border}"
                 BorderThickness="1"/>
      </TabItem>
    </TabControl>
  </Grid>
</Window>
