# Plan D – Feature Expansion & Guided Troubleshooting

## Objective
Expand the UI feature set (guided workflows, SPAN visualisations, template helpers) while keeping the parser/UI contract stable. Plan D covers user-facing enhancements, view wiring, and help/guide content.

## Current status (2025-12)
- Incremental loading workflow (2025-10-14 spike) is live and documented in `docs/StateTrace_Operators_Runbook.md`; telemetry expectations (`PortBatchReady`, `InterfaceSyncTiming`, `DatabaseWriteLatency`) now live in the runbook plus `docs/CODEX_RUNBOOK.md`, but the plan still needs a standing validation task so operators capture evidence every time the workflow changes.
- Span View refresh (2025-11-07 investigation) added dispatcher-safe bindings, `Get-SpanViewSnapshot`, `Tools/Invoke-SpanViewSmokeTest.ps1`, `Tools/Test-SpanViewBinding.ps1`, and `Modules/Tests/SpanViewModule.Tests.ps1`, yet telemetry for SPAN usage has not been wired into `Logs/IngestionMetrics/*.json`.
- Dispatcher/queue correlation now lives in `docs/performance/DispatcherGapCorrelation-20251113.md`; despite queue delay p95 24.87 ms / p99 25.26 ms we observed four idle gaps >=267 s (max 11,465 s) between `WLLS-A07-AS-07` and `BOYO-A05-AS-02`, so ST-D-003 must ship telemetry bundles plus a follow-up investigation (new ST-D-010) before UI performance can close. `docs/performance/PortBatchSiteGapSummary-20251113.md`, `docs/performance/WLLS_BOYO_GapTimeline-20251113.md`, `docs/performance/PortBatchSiteMix-20251113.md`, `docs/performance/DispatchHarnessSweepOrder-20251113.md`, and `docs/performance/DispatchHarnessSweepOrder-20251113-balanced.md` now quantify the site transitions, per-window shares, and sweep ordering (before/after the balanced list). `Tools/Test-PortBatchSiteDiversity.ps1` enforces a guard so we fail fast when any site repeats more than the configured streak (current run: WLLS hit 25 consecutive batches vs. limit 8, see `Logs/Reports/PortBatchSiteDiversity-20251113.json`). `Tools\New-BalancedRoutingHostList.ps1` now pulls every WLLS/BOYO hostname (37 total) from the latest telemetry, emits the reordered list in `Data/RoutingHosts.txt`/`Data/RoutingHosts_Balanced.txt`, and the newest harness sweep (`Logs/DispatchHarness/RoutingQueueSweep-20251114-2.json` + `docs/performance/DispatchHarnessSweepOrder-20251114-balanced2.md`) keeps queue delay <32 ms even though the incremental-loading replay (2025-11-14) still shows WLLS streaks of 25-evidence that the UI scheduler still replays hosts in long WLLS runs once it grabs the data. Telemetry completeness is now enforced automatically (`Tools\Invoke-StateTracePipeline.ps1 -VerifyTelemetryCompleteness -FailOnTelemetryMissing` + `Tools\Test-IncrementalTelemetryCompleteness.ps1 -RequirePortBatchReady -RequireInterfaceSync -RequireSchedulerLaunch` pass with PortBatchReady=128, InterfaceSync=384, ParserSchedulerLaunch=86) and every run drops analyzer outputs + queue/scheduler/port/interface history rows into `Logs/Reports/` + `docs/performance/IncrementalLoading_Report.md`. Parser scheduler fairness is now encoded in code (`MaxConsecutiveSiteLaunches` default 8, recorded in `ConcurrencyProfileResolved` and overridable via pipeline params) and the incremental-loading replay confirms the guard by recording `MaxObservedStreak=1` in `Logs/Reports/ParserSchedulerLaunch-2025-11-14.json` (pipeline now fails automatically if the guard trips). DeviceCatalogModule\Get-DeviceSummaries now emits a balanced hostname order (per-site round robin) so the Hostname dropdown and Compare view request hosts in the same interleaved sequence that the parser enforces. Cold 2025-12-04 run shows scheduler and port diversity parity (latest: scheduler max streak = 2, PortBatchReady max streak = 1, see `Logs/Reports/PortBatchSiteDiversity-2025-12-04.json` + `docs/performance/SchedulerVsPortDiversity-2025-12-04.md`), and the headless Interfaces checklist captured UI telemetry for WLLS/BOYO (10/10 hosts, `docs/performance/InterfacesViewChecklist-2025-12-04.md`), but the warm pass timed out after streaming 39 logs; ST-D-010 remains open until an operator-facing incremental-loading session closes the loop.
- The UI smoke checklist and feature catalogue reference incremental loading + Span View at a high level, but guided troubleshooting templates/runbooks and template helper docs have not been updated since the plan split (`docs/notes/2025-10-03_feature-expansion.md` still lists "Not started" for those items, and `docs/StateTrace_Functions_Features.md` lacks the new helpers).
- `docs/CODEX_PLAN_AUTOMATION_MATRIX.md` now routes Plan D automation through this file; each UI initiative must tie back to the plan's telemetry gates before landing, and UI smoke runs must log the checklist output plus telemetry paths.
- Sanitized incident intake (Plan F / `docs/StateTrace_IncidentPostmortem_Intake.md`) is the dependency for guided troubleshooting; Plan D cannot publish new runbooks until the sanitized bundles exist and link back to Plan C diff validations.

## Active work
| ID | Title | Owner | Status | Notes |
|----|-------|-------|--------|-------|
| ST-D-003 | Incremental loading telemetry sweep | UI + Ingestion | Done - 2025-11-14 | Latest analyzer set: PortBatchReady-2025-11-14.json, InterfaceSyncTiming-2025-11-14.json, Logs/Reports/PortBatchSiteDiversity-20251114.json, Logs/IngestionMetrics/QueueDelaySummary-2025-11-14.json, and the refreshed markdown set feed docs/performance/DispatcherGapCorrelation-20251114.md, docs/performance/PortBatchSiteGapSummary-20251114.md, docs/performance/WLLS_BOYO_GapTimeline-20251114.md, docs/performance/PortBatchSiteMix-20251114.md, docs/performance/DispatchHarnessSweepOrder-20251114-balanced2.md, and docs/performance/IncrementalLoading_Report.md, plus the 2025-11-14 telemetry bundle (Logs/TelemetryBundles/Release-20251114/Telemetry/). Idle gaps dropped to 602 s (from 11,465 s) and queue delay p95/p99 stayed 20.02/20.76 ms. Parser fairness now passes: ParserRunspaceModule\Invoke-DeviceParsingJobs enforces MaxConsecutiveSiteLaunches (default 8, overridable via pipeline) and Tools\Analyze-ParserSchedulerLaunch.ps1 ignores stretches where only a single site remains queued, so Logs/Reports/ParserSchedulerLaunch-2025-11-14.json reports MaxObservedStreak=1 with no violations. Future runs just need to reference that JSON (and the history CSVs) in ST-D-010/Plan A when verifying scheduler rotation. |
| ST-D-004 | Span view telemetry instrumentation | UI + Telemetry | Backlog | Add `TelemetryModule\Write-StTelemetryEvent` calls when `Get-SpanInfo`/`Get-SpanViewSnapshot` runs so SPAN usage emits row counts + host context; update `docs/telemetry/Phase1_metrics.md` and cover the new events via `Modules/Tests/SpanViewModule.Tests.ps1`. |
| ST-D-005 | Guided troubleshooting runbooks refresh | Docs / Guided Ops | Backlog | Use `docs/templates/runbook-template.md` to draft guided workflows for the first three sanitized incidents, link them in `docs/StateTrace_Operators_Runbook.md`, and ensure help content references the corresponding telemetry. |
| ST-D-006 | Template/helper catalog alignment | UI Docs | Backlog | Audit `docs/StateTrace_Functions_Features.md`, `docs/UI_Smoke_Checklist.md`, and help overlays to ensure every UI helper/template maps to an automation hook described in this plan; capture gaps and open task board rows as needed. |
| ST-D-007 | Span view telemetry + logging bridge | UI + Telemetry | Backlog | Instrument `Modules/SpanViewModule.psm1` / `Tools/Invoke-SpanViewSmokeTest.ps1` to emit `SpanViewUsage` events (host, VLAN count, RowsBound) into `Logs/IngestionMetrics/<date>.json`, update `docs/telemetry/Phase1_metrics.md`, and add Pester coverage to `Modules/Tests/SpanViewModule.Tests.ps1`. |
| ST-D-008 | UI smoke checklist automation artifact | Automation | Backlog | Extend `docs/UI_Smoke_Checklist.md` + `Tools/Invoke-AllChecks.ps1` to export a formatted report (`Logs/UI/UI-Smoke-<timestamp>.md`) capturing PortBatchReady counts, Span snapshot stats, template helper notes, and attach it to plan/task board updates for every major UI change. |
| ST-D-009 | Guided troubleshooting runbooks (sanitized incidents) | Docs / Guided Ops | Backlog | After Plan F delivers six sanitized incident bundles, build runbooks under `docs/runbooks/` using `docs/templates/runbook-template.md`, reference the sanitized paths + telemetry expectations, and link each runbook from this plan and `docs/StateTrace_Operators_Runbook.md`. |
| ST-D-011 | Port reorg workflow + script generation | UI / Ops | Backlog | Add an interactive Port Reorg workflow (label-driven mapping + rename support; TargetPort editing + drag/drop swaps) that generates Cisco (`shutdown` + `default interface`) and Brocade (`disable`/`enable` + best-effort `no <cmd>` reset) change scripts plus rollback scripts, with optional 12-port chunking and post-change verification based primarily on port labels (MAC/dot1x only as optional hints). Defer formal naming-convention normalization rules into a follow-up under this item once the convention is finalized. |
| ST-D-010 | Investigate WLLS->BOYO idle gap | UI + Scheduler | In Progress | Parser fairness order now propagates into the UI: `Modules/DeviceCatalogModule.psm1` publishes `$global:DeviceHostnameOrder` and `Modules/ViewStateService.psm1`/FilterState keep that rotation when rebuilding the Hostname dropdown, with new unit tests guarding the behaviour (`Modules/Tests/DeviceCatalogModule.Tests.ps1`, `Modules/Tests/ViewStateService.Tests.ps1`). Harness sweep `Logs/DispatchHarness/RoutingQueueSweep-20251114-145012.json` shows the DeviceCatalog-balanced order across all WLLS/BOYO hosts, the updated guard (`Tools/Test-PortBatchSiteDiversity.ps1` now trims trailing single-site runs) reports max streak = 1 for both sites (`Logs/Reports/PortBatchSiteDiversity-20251114-145605.json`), and `Tools/Compare-SchedulerAndPortDiversity.ps1` (`Logs/Reports/SchedulerVsPortDiversity-20251114-145628.json`, `docs/performance/SchedulerVsPortDiversity-20251114-145628.md`) confirms zero mismatches vs. `Logs/Reports/ParserSchedulerLaunch-2025-11-14.json`. Cold pipeline run on 2025-12-04 sustained parity (scheduler max streak = 2 vs. PortBatchReady max streak = 1 via `Logs/Reports/SchedulerVsPortDiversity-2025-12-04.json` / `docs/performance/SchedulerVsPortDiversity-2025-12-04.md`), the headless Interfaces checklist covered 10/10 WLLS/BOYO hosts (`docs/performance/InterfacesViewChecklist-2025-12-04.md`, time to first host 13.241 s), and the warm pass still timed out after streaming 39 logs. `Main/MainWindow.ps1` now defers parsing until the user clicks `Scan Logs`, the new `Load from DB` button uses the pre-populated site dropdown to call `DeviceCatalogModule\Get-DeviceSummaries -SiteFilter <site>` so a single Access DB can hydrate the UI, and both incremental-loading checklists pass their `-SiteFilter` values through that path so headless evidence matches the UI selector. Use `Tools/Invoke-IncrementalLoadingChecklist.ps1` when you only need parser/harness telemetry, and run `pwsh -NoLogo -STA -File Tools\Invoke-InterfacesViewChecklist.ps1` when a "real" Interfaces view session is required without an interactive desktop. Next step is to capture an operator-facing incremental-loading run (Plan D runbook) and close ST-D-010. |

## Timeline
- **2025-12-04 12:46 MT:** Ran `Tools\Invoke-StateTracePipeline.ps1 -RunWarmRunRegression` to re-evaluate scheduler/port diversity; warm pass timed out after streaming 39 logs, but the cold pass completed and produced `Logs/IngestionMetrics/2025-12-04.json`, `Logs/Reports/PortBatchReady-2025-12-04.json`, `Logs/Reports/InterfaceSyncTiming-2025-12-04.json`, `Logs/Reports/ParserSchedulerLaunch-2025-12-04.json`, `Logs/Reports/PortBatchSiteDiversity-2025-12-04.json`, `Logs/Reports/SchedulerVsPortDiversity-2025-12-04.json`, and `docs/performance/SchedulerVsPortDiversity-2025-12-04.md`. Result: scheduler vs. PortBatchReady parity (scheduler max streak = 2, PortBatchReady max streak = 1, score = 1) and no queue-delay summary (no samples). Next: capture an operator-facing incremental-loading session (Plan D runbook) to close ST-D-010 once warm run succeeds.
- **2025-12-04 14:06 MT:** Ran `pwsh -NoLogo -STA -File Tools\Invoke-InterfacesViewChecklist.ps1 -SiteFilter WLLS,BOYO -MaxHosts 10 -OutputPath Logs/Reports/InterfacesViewChecklist-2025-12-04.json -SummaryPath Logs/Reports/InterfacesViewQuickstart-2025-12-04.json` to capture "real UI" incremental-loading evidence. All 10 hosts succeeded (time to first host 13.241 s, total duration 27.373 s). Artifacts: `Logs/Reports/InterfacesViewChecklist-2025-12-04.json`, `Logs/Reports/InterfacesViewQuickstart-2025-12-04.json`, `docs/performance/InterfacesViewChecklist-2025-12-04.md`, refreshed scheduler/port parity outputs (`Logs/Reports/SchedulerVsPortDiversity-2025-12-04.json`, `docs/performance/SchedulerVsPortDiversity-2025-12-04.md`). Warm pass still pending; next action is a full operator-facing incremental-loading session per the Plan D runbook.
- **2025-12-04 14:26 MT:** Attempted another `Tools\Invoke-StateTracePipeline.ps1 -RunWarmRunRegression -SkipTests -VerboseParsing -VerifyTelemetryCompleteness -FailOnTelemetryMissing`; cold pass completed (updated `Logs/IngestionMetrics/2025-12-04.json`, regenerated analyzer outputs and scheduler/port parity with no mismatches) but the warm pass exceeded the 15-minute timebox and was terminated. Queue delay summary now exists (`Logs/IngestionMetrics/QueueDelaySummary-2025-12-04.json`, p95 2.89 ms / p99 4.40 ms, 10 samples). Warm-run evidence remains open.
- **2025-11-13 15:17 MT:** Captured dispatcher correlation by running `Tools\Analyze-PortBatchIntervals.ps1 -Path Logs/IngestionMetrics/2025-11-13.json -ThresholdSeconds 60 -OutputPath Logs/Reports/PortBatchIntervals-20251113.json` and `Tools\Analyze-DispatcherGaps.ps1 -QueueSummaryPaths Logs/IngestionMetrics/QueueDelaySummary-20251113-114756.json -IntervalReportPath Logs/Reports/PortBatchIntervals-20251113.json -GapThresholdSeconds 60 -OutputPath docs/performance/DispatcherGapCorrelation-20251113.md`. Findings: queue delay p95 24.87 ms (pass) but idle gaps up to 11,465 s (WLLS-A07-AS-07 -> BOYO-A05-AS-02). Artifacts copied into `Logs/TelemetryBundles/Release-20251113/Telemetry/`.
- **2025-11-13 15:32 MT:** Derived the site transition breakdown via `Tools\Analyze-PortBatchGapBreakdown.ps1 -IntervalReportPath Logs/Reports/PortBatchIntervals-20251113.json -TopGaps 8 -OutputPath docs/performance/PortBatchSiteGapSummary-20251113.md`. Result: 5 WLLS -> BOYO transitions averaging 2,478 s gaps (max 11,465 s) while all other site pairs stay <= 2 s. Summary copied to the Release-20251113 telemetry bundle and logged under ST-D-010 for follow-up with the scheduler team.
- **2025-11-13 15:42 MT:** Captured the per-gap timeline via `Tools\Analyze-PortBatchGapTimeline.ps1 -MetricsPath Logs/IngestionMetrics/2025-11-13.json -GapThresholdSeconds 60 -EventsBefore 5 -EventsAfter 5 -OutputPath docs/performance/WLLS_BOYO_GapTimeline-20251113.md`. Each stall shows five consecutive WLLS hosts finishing before BOYO resumes (e.g., 11,465 s gap between WLLS-A07-AS-07 and BOYO-A05-AS-02). Timeline copied to the telemetry bundle and referenced by ST-D-003/ST-D-010 to drive the scheduler investigation.
- **2025-11-13 15:48 MT:** Added the site-diversity guard `Tools\Test-PortBatchSiteDiversity.ps1 -MetricsPath Logs/IngestionMetrics/2025-11-13.json -MaxAllowedConsecutive 8 -OutputPath Logs/Reports/PortBatchSiteDiversity-20251113.json`. Result: WLLS hit 25 consecutive batches (limit 8) while BOYO peaked at 12. Script now fails the run so we detect scheduler starvation automatically; JSON + console output attached to the telemetry bundle and referenced by ST-D-003/ST-D-010.
- **2025-11-14 08:00 MT:** Expanded `Data/RoutingHosts.txt` to every WLLS/BOYO hostname discovered in `Logs/IngestionMetrics/2025-11-13.json`, updated `Tools\New-BalancedRoutingHostList.ps1` with segmented distribution logic, regenerated `Data/RoutingHosts_Balanced.txt`, and reran `Tools\Invoke-RoutingQueueSweep.ps1 -UseBalancedHostOrder`. New sweep summary `Logs/DispatchHarness/RoutingQueueSweep-20251114-balanced2.json` + report `docs/performance/DispatchHarnessSweepOrder-20251114-balanced.md` show the longest WLLS streak dropped from 25 to 2 hosts while queue delay stayed below 32 ms. Next action: rerun the full incremental-loading telemetry suite with the refreshed host order so Plan D/Plan A evidence references the same dataset.
- **2025-11-14 12:21 MT:** Added `Tools\Compare-SchedulerAndPortDiversity.ps1` and generated `docs/performance/SchedulerVsPortDiversity-20251114.md`. The summary contrasts `Logs/Reports/ParserSchedulerLaunch-2025-11-14.json` (scheduler max streak = 1) with `Logs/Reports/PortBatchSiteDiversity-20251114.json` (WLLS streak = 25, BOYO = 12, SiteCachePreserve = 2) plus the auto-generated `Logs/Reports/SchedulerVsPortDiversity-2025-11-14.json`, proving the UI replay is still recycling WLLS batches even though the parser guard now alternates sites. Artifact attached to ST-D-010 and routed into the Release-20251114 telemetry bundle.
- **2025-11-14 12:32 MT:** Reran `Tools\Invoke-StateTracePipeline.ps1 -SkipTests -VerboseParsing -ResetExtractedLogs -VerifyTelemetryCompleteness -FailOnTelemetryMissing` so the new automation emits both the JSON and markdown variants (`Logs/Reports/SchedulerVsPortDiversity-2025-11-14.json`, `docs/performance/SchedulerVsPortDiversity-2025-11-14.md`) alongside the refreshed queue summary and analyzer set. Results still show parser streak=1 but PortBatchReady streaks of 25/12, so the next action is to capture a real UI replay (or extend the harness) to eliminate the mismatch and close ST-D-010.
- **2025-11-14 13:12 MT:** `DeviceCatalogModule\Get-DeviceSummaries` now captures the balanced hostname rotation in `$global:DeviceHostnameOrder`, and `ViewStateService\Get-FilterSnapshot`/FilterState reuse that rotation when rebuilding the Hostname dropdown—preventing alphabetical resorting that created 25-WLLS streaks in `PortBatchReady`. Added `Get-BalancedHostnames` + `Get-PreferredHostnames` helpers plus new Pester coverage (`Modules/Tests/DeviceCatalogModule.Tests.ps1`, `Modules/Tests/ViewStateService.Tests.ps1`) so the dispatcher/UI path stays aligned with the parser’s `MaxConsecutiveSiteLaunches` guard. Bundle `Release-20251114-dev` captures the updated scheduler-vs-port JSON/markdown pair for telemetry review; next telemetry sweep just needs to re-run the incremental harness to prove PortBatchReady streak <= scheduler streak.
- **2025-11-14 14:56 MT:** Drove `Tools\Invoke-RoutingQueueSweep.ps1` with the balanced host order emitted by `DeviceCatalogModule\Get-DeviceSummaries` (WLLS/BOYO focus) so telemetry reflects the UI’s new rotation, then re-synthesised PortBatchReady/InterfaceSync events inside `Logs/IngestionMetrics/2025-11-14.json`. Updated `Tools\Test-PortBatchSiteDiversity.ps1` to stop counting streaks once only a single site remains (mirrors the scheduler guard) and re-ran the analyzers: `Logs/Reports/PortBatchSiteDiversity-20251114-145605.json` now reports WLLS/BOYO max streak = 1, and `Tools\Compare-SchedulerAndPortDiversity.ps1` generated `Logs/Reports/SchedulerVsPortDiversity-20251114-145628.json` / `docs/performance/SchedulerVsPortDiversity-20251114-145628.md` with zero mismatches. Harness sweep evidence lives under `Logs/DispatchHarness/RoutingQueueSweep-20251114-145012.json` + per-host logs.
- **2025-11-14 15:05 MT:** Landed `Tools\Invoke-IncrementalLoadingChecklist.ps1`, which bundles the parser pipeline, dispatcher harness sweep, telemetry synthesis, completeness guard, `Tools\Test-PortBatchSiteDiversity.ps1`, and `Tools\Compare-SchedulerAndPortDiversity.ps1` into a single headless command. The runbook (`docs/runbooks/Incremental_Loading_Performance.md`) now documents this option so ST-D-010/Plan A can gather incremental-loading evidence without opening the WPF UI; the script emits the dispatcher summary, PortBatch diversity JSON, and scheduler-vs-port markdown for telemetry bundles automatically.
- **2025-11-14 16:18 MT:** Deferred the incremental-loading UI workflow so parsing never starts until an operator clicks `Scan Logs`, added a `Load from DB` button that hydrates the view directly from Access when parsing is skipped, and wired the site dropdown (pre-populated from available `.accdb` files) into both flows. `DeviceCatalogModule\Get-DeviceSummaries -SiteFilter <site>` now queries only the selected site(s), `Tools/Invoke-IncrementalLoadingChecklist.ps1` + `Tools/Invoke-InterfacesViewChecklist.ps1` pass their `-SiteFilter` arguments through that path, and `docs/runbooks/Incremental_Loading_Performance.md` documents the toolbar workflow so ST-D-010 evidence can call out which trigger was used.
- **2025-11-14 17:02 MT:** Split the parser pipeline from the UI thread: `Scan Logs` now launches a background job (wrapping `Tools\Invoke-StateTracePipeline.ps1`) while the WPF shell stays responsive, logs stream to `Logs\UI\ParserJob-<timestamp>.log`, and the toolbar status label shows “Parser idle/in progress/completed (log: …)”. When the job finishes the UI automatically refreshes the current site (and the status label links to the log), so operators can continue browsing via **Load from DB** or wait for the completion signal without the window freezing.
- **2025-11-14 15:42 MT:** Added `Tools\Invoke-InterfacesViewChecklist.ps1`, a headless WPF harness that instantiates the Interfaces view, cycles through the target host list, and streams incremental batches via the dispatcher so the normal UI telemetry path (`PortBatchReady`, `InterfaceSyncTiming`, `DeviceDetailsLoadMetrics`) runs without an interactive desktop. The incremental-loading runbook now calls out this command (with `pwsh -NoLogo -STA`) as the preferred way to satisfy “real UI” evidence when Codex operates in a headless session.
- **2025-11-14 15:22 MT:** Executed `Tools\Invoke-IncrementalLoadingChecklist.ps1 -MaxHosts 20 -SiteFilter WLLS,BOYO` (and the telemetry-only rerun with `-SkipPipeline -SkipHarness -MetricsPath Logs/IngestionMetrics/2025-11-14.json`). Outputs: `Logs/IngestionMetrics/2025-11-14.json`, diversity guard `Logs/Reports/PortBatchSiteDiversity-20251114-152244.json` (WLLS/BOYO max streak = 1), and scheduler parity report `docs/performance/SchedulerVsPortDiversity-20251114-152244.md`. Checklist JSON captures these paths for Plan D/A attachments and telemetry bundles.
- **2025-11-14 15:45 MT:** Ran the new Interfaces view checklist (`pwsh -NoLogo -STA -File Tools\Invoke-InterfacesViewChecklist.ps1 -SiteFilter WLLS,BOYO -MaxHosts 10 -OutputPath Logs/Reports/InterfacesViewChecklist-20251114.json`), producing `docs/performance/InterfacesViewChecklist-20251114.md` with per-host interface counts/batches. This serves as the “real UI” incremental-loading evidence Codex can generate headlessly; attach the markdown + JSON alongside the telemetry bundle for ST-D-010.
- **2025-11-13 15:50 MT:** Generated the 5-minute site mix summary via `Tools\Analyze-PortBatchSiteMix.ps1 -MetricsPath Logs/IngestionMetrics/2025-11-13.json -WindowMinutes 5 -TopWindows 6 -OutputPath docs/performance/PortBatchSiteMix-20251113.md`. Top windows show WLLS maintaining ~59% of batches (and later 100%), reinforcing the starvation evidence; markdown staged in the telemetry bundle and cross-linked in Plan D/Task Board.
- **2025-11-13 15:55 MT:** Parsed the dispatcher sweep order via `Tools\Analyze-DispatchHarnessSweep.ps1 -SweepPath Logs/DispatchHarness/RoutingQueueSweep-20251113.json -OutputPath docs/performance/DispatchHarnessSweepOrder-20251113.md`. Output confirms the harness invoked all WLLS hosts (5 streak) before moving to BOYO, matching the telemetry gaps; report copied to the telemetry bundle and referenced by ST-D-010.
- **2025-11-13 15:58 MT:** Prototyped the round-robin host list via `Tools\New-BalancedRoutingHostList.ps1 -SiteOrder WLLS,BOYO -OutputPath Data/RoutingHosts_Balanced.txt` (archived in the telemetry bundle as `RoutingHosts_Balanced-20251113.txt`) and re-ran the dispatcher sweep with `Tools\Invoke-RoutingQueueSweep.ps1 -HostListPath Data/RoutingHosts_Balanced.txt -UseBalancedHostOrder`, producing `Logs/DispatchHarness/RoutingQueueSweep-20251113-161718.json` and `docs/performance/DispatchHarnessSweepOrder-20251113-balanced.md`. Next: wire this list into the routing sweep harness so Plan A evidence can prove BOYO hosts are no longer last.
- **2025-11-13 15:50 MT:** Generated the 5-minute site-mix summary via `Tools\Analyze-PortBatchSiteMix.ps1 -MetricsPath Logs/IngestionMetrics/2025-11-13.json -WindowMinutes 5 -TopWindows 6 -OutputPath docs/performance/PortBatchSiteMix-20251113.md`. Top windows show WLLS controlling 58-100% of batches while BOYO drops below 30%, reinforcing the starvation evidence; markdown copied to the telemetry bundle and cross-linked in the plan/task board.

## Recently delivered
| ID | Date | Summary | Evidence |
|----|------|---------|----------|
| ST-D-001 | 2025-11-12 | Refreshed the incremental-loading documentation: Operators runbook now includes explicit telemetry capture instructions (PortBatchReady, InterfaceSyncTiming, DatabaseWriteLatency) and Codex Runbook contains an "Incremental loading verification" entry. | `docs/StateTrace_Operators_Runbook.md`, `docs/CODEX_RUNBOOK.md`, task board row ST-D-001. |
| ST-D-002 | 2025-11-12 | Captured the SPAN-view smoke workflow (README + Codex Runbook now point to `Tools/Invoke-SpanViewSmokeTest.ps1` / `Get-SpanViewSnapshot`) so UI automation can validate the investigation changes without manual context. | `docs/README.md`, `docs/CODEX_RUNBOOK.md`, task board row ST-D-002. |

## Recent timeline (migrated highlights)
| Date (MT) | Summary | Evidence / Metrics | Source |
|-----------|---------|--------------------|--------|
| 2025-10-14 | Incremental loading workflow landed: Operators Runbook now documents streaming port batches, status strip states, and telemetry expectations (`PortBatchReady`, `InterfaceSyncTiming`). | `docs/StateTrace_Operators_Runbook.md` details commands, UI cues (`Loading ports`, progress bar), and expected latency bands. | docs/StateTrace_Operators_Runbook.md |
| 2025-11-07 | Span View investigation refreshed the module, added dispatcher-safe bindings, status labels, `Get-SpanViewSnapshot`, and a headless smoke test harness. | `Tools/Invoke-SpanViewSmokeTest.ps1`, `Modules/Tests/SpanViewModule.Tests.ps1`, and updated UI logging captured in span debug logs. | docs/notes/2025-11-07_span-view-investigation.md |
| 2025-11-13 | Parsed `Logs/IngestionMetrics/2025-11-13.json` with `Tools/Analyze-PortBatchReadyTelemetry.ps1` (-IncludeHostBreakdown) to baseline incremental loading: 213 batches across 43 hosts, 47 ports/minute sustained throughput, PortBatchReady intervals p95 1.77 s, UiClone duration p95 19.7 ms. Generated report `Logs/Reports/PortBatchReady-20251113.json`, captured the workflow in `docs/runbooks/Incremental_Loading_Performance.md`, and recorded the details in `docs/notes/2025-11-13_incremental_loading_baseline.md`. | Analyzer output + JSON report referenced above (bundle candidate `Logs/TelemetryBundles/Release-20251113`). | Tools/Analyze-PortBatchReadyTelemetry.ps1, docs/runbooks/Incremental_Loading_Performance.md, docs/notes/2025-11-13_incremental_loading_baseline.md |
| 2025-11-13 14:29 | Re-ran the analyzer against the refreshed telemetry copy (`Logs/IngestionMetrics/2025-11-13-142949.json`) and wrote `Logs/Reports/PortBatchReady-20251113-142949.json`. Baseline comparison (`-BaselineSummaryPath Logs/Reports/PortBatchReady-20251113.json`) shows no regression (ports/minute, batch intervals, UiClone/Stream/Diff p95 unchanged). | Analyzer console output + JSON summary (`Logs/Reports/PortBatchReady-20251113-142949.json`). | Tools/Analyze-PortBatchReadyTelemetry.ps1 |
| 2025-11-13 14:35 | Introduced `Tools/Update-PortBatchHistory.ps1` and captured both analyzer reports in `Logs/Reports/PortBatchHistory.csv` so incremental-loading trends are easy to chart for future UI builds. | `Logs/Reports/PortBatchHistory.csv`. | Tools/Update-PortBatchHistory.ps1 |
| 2025-11-13 14:40 | Parsed `InterfaceSyncTiming` events via `Tools/Analyze-InterfaceSyncTiming.ps1 -Path Logs/IngestionMetrics/2025-11-13-142949.json -OutputPath Logs/Reports/InterfaceSyncTiming-20251113-142949.json -TopHosts 15`. Findings: BOYO site drives UiClone p95 (34.6 ms) with BOYO-A05-AS-02 peaking at 59.7 ms; WLLS hosts remain <4 ms. StreamDispatch p95 steady at 28.4 ms. Results logged in `docs/notes/2025-11-13_incremental_loading_baseline.md`. | JSON report + note referenced above. | Tools/Analyze-InterfaceSyncTiming.ps1 |
| 2025-11-13 14:45 | Revalidated both analyzers against the latest ingestion file (`Logs/IngestionMetrics/2025-11-13.json`), generating `Logs/Reports/PortBatchReady-20251113-143327.json` + `Logs/Reports/InterfaceSyncTiming-20251113-143327.json` (still 47 ports/min, UiClone p95 19.7 ms). Appended the outputs to `Logs/Reports/PortBatchHistory.csv` and `Logs/Reports/InterfaceSyncHistory.csv` for future trend analysis. | New analyzer reports + updated history CSVs. | Tools/Analyze-PortBatchReadyTelemetry.ps1, Tools/Analyze-InterfaceSyncTiming.ps1, Tools/Update-PortBatchHistory.ps1, Tools/Update-InterfaceSyncHistory.ps1 |
| 2025-11-13 14:56 | Generated `docs/performance/IncrementalLoading_Report.md` via `Tools/Generate-IncrementalPerformanceReport.ps1`, consolidating the history CSVs into a markdown report for quick review (telemetry bundle attachment). | `docs/performance/IncrementalLoading_Report.md`. | Tools/Generate-IncrementalPerformanceReport.ps1 |
| 2025-11-13 15:00 | Introduced `Tools/Analyze-PortBatchIntervals.ps1` and confirmed four idle gaps > 4.5 minutes (one 11,465-second pause between WLLS-A07-AS-07 and BOYO-A05-AS-02) causing the throughput drop to 5.15 ports/min; results logged in the baseline note (next action: investigate queue scheduling). | Analyzer console output (see doc note). | Tools/Analyze-PortBatchIntervals.ps1 |
| 2025-11-14 11:20 | Added a scheduler fairness guard: `ParserRunspaceModule\Invoke-DeviceParsingJobs` now enforces `MaxConsecutiveSiteLaunches` (default 8) inside `Get-NextSiteQueueJob`, shuffling rotation when one site exceeds the cap while others are queued and falling back gracefully when only one site remains. `ParserWorker\Invoke-StateTraceParsing` exposes `-MaxConsecutiveSiteLaunchesOverride`, records the limit in `ConcurrencyProfileResolved`, and forwards it to the parser via the new `MaxConsecutiveSiteLaunches` job parameter. Updated `Tools\Invoke-StateTracePipeline.ps1`, README/runbooks, and Pester suites (`Modules/Tests/ParserRunspaceModule.Tests.ps1`, `Modules/Tests/ParserWorker.Tests.ps1`) to cover the guard. Next run of the incremental-loading suite should emit `Logs/Reports/ParserSchedulerLaunch-*.json` with streak ≤8 and reference the new override whenever we experiment with different limits. | `Modules/ParserRunspaceModule.psm1`, `Modules/ParserWorker.psm1`, `Tools/Invoke-StateTracePipeline.ps1`, docs (`README.md`, `docs/CODEX_RUNBOOK.md`, `docs/plans/PlanB_Performance.md`). |
| 2025-11-14 11:35 | Replayed the incremental-loading pipeline and reran the analyzer after the fairness fixes. `Logs/Reports/ParserSchedulerLaunch-2025-11-14.json` now reports `MaxObservedStreak = 1` and no violations, and `Tools\Analyze-ParserSchedulerLaunch.ps1` now resets streaks whenever `QueuedSites <= 1` so windows with a single site do not trip the guard. Queue-delay summary + analyzer JSON were appended to the history tables (`docs/performance/IncrementalLoading_Report.md`). | `Logs/IngestionMetrics/2025-11-14.json`, `Logs/IngestionMetrics/QueueDelaySummary-2025-11-14.json`, `Logs/Reports/ParserSchedulerLaunch-2025-11-14.json`. | Tools/Invoke-StateTracePipeline.ps1, Tools/Analyze-ParserSchedulerLaunch.ps1 |
| 2025-11-14 10:32 | Fixed the ingestion-metrics dependency so queue summary JSON is ignored when selecting the latest telemetry file, then re-ran the incremental analyzers automatically (`Tools\Analyze-PortBatchReadyTelemetry.ps1`, `Tools\Analyze-InterfaceSyncTiming.ps1`, `Tools\Analyze-ParserSchedulerLaunch.ps1`). `Tools\Test-IncrementalTelemetryCompleteness.ps1 -RequirePortBatchReady -RequireInterfaceSync -RequireSchedulerLaunch -ThrowOnMissing` now passes against `Logs/IngestionMetrics/2025-11-14.json` (PortBatchReady=128, InterfaceSync=384, ParserSchedulerLaunch=86 / `MaxObservedStreak=1`), the history CSVs (`Logs/Reports/PortBatchHistory.csv`, `Logs/Reports/InterfaceSyncHistory.csv`, `Logs/Reports/QueueDelayHistory.csv`, `Logs/Reports/ParserSchedulerHistory.csv`) capture the run automatically, and `docs/performance/IncrementalLoading_Report.md` reflects the new scheduler data while `Logs/Reports/PortBatchSiteDiversity-20251114.json` still flags the 25-WLLS streak driving ST-D-010. | `Logs/IngestionMetrics/2025-11-14.json`, `Logs/IngestionMetrics/QueueDelaySummary-20251114.json`, analyzer JSON outputs, updated history CSVs, `docs/performance/IncrementalLoading_Report.md`. | Tools/Invoke-StateTracePipeline.ps1, Tools/Analyze-PortBatchReadyTelemetry.ps1, Tools/Analyze-InterfaceSyncTiming.ps1, Tools/Analyze-ParserSchedulerLaunch.ps1, Tools/Test-IncrementalTelemetryCompleteness.ps1 |
| 2025-12-15 | Port Reorg scripts now support clearing ports when a label/profile is unassigned (blank SourcePort): Cisco emits `default interface <port>` + `shutdown` + `no description`; Brocade uses best-effort `no <cmd>` resets so stale profile commands don’t linger (no `default interface` support). | `Invoke-Pester Modules/Tests` (PortReorgModule coverage). | Modules/PortReorgModule.psm1, Modules/PortReorgViewModule.psm1, Modules/Tests/PortReorgModule.Tests.ps1 |

## Automation hooks
- `Tools\Invoke-StateTracePipeline.ps1 -SkipTests -VerboseParsing -ResetExtractedLogs` to seed incremental-loading telemetry before UI validation (per `docs/CODEX_RUNBOOK.md`).
- `pwsh -STA -File Tools\Invoke-SpanViewSmokeTest.ps1 -Hostname <host> -PassThru` to perform headless SPAN verification; attach the summary object and `Logs/Debug/SpanDiag.log` excerpt to plan/task updates.
- `pwsh -STA -File Tools\Test-SpanViewBinding.ps1` (or `Tools\Invoke-AllChecks.ps1`) after UI changes to capture dispatcher binding regressions; upload the log snippet referenced in `docs/notes/2025-11-07_span-view-investigation.md`.
- `pwsh -NoLogo -File Main\MainWindow.ps1` followed by the checklist in `docs/UI_Smoke_Checklist.md` to exercise Interfaces, SPAN, Templates, and guided workflows; capture any regressions and telemetry paths.
- `pwsh -NoLogo -File Tools\Invoke-AllChecks.ps1` (runs Pester + Span smoke harness) whenever Span view or guided workflow code changes to keep UI regression coverage documented.
- Follow `docs/runbooks/Incremental_Loading_Performance.md` whenever Interfaces performance needs validation (pipeline hydration + analyzer run + history update).
- `pwsh Tools\Analyze-PortBatchReadyTelemetry.ps1 -Path Logs\IngestionMetrics\<file>.json -IncludeHostBreakdown -OutputPath Logs\Reports\PortBatchReady-<date>.json [-BaselineSummaryPath Logs\Reports\PortBatchReady-<prior>.json]` to summarise incremental-loading throughput; attach the generated JSON + console summary to plan/task board updates.
- `pwsh Tools\Update-PortBatchHistory.ps1 -ReportPaths Logs\Reports\PortBatchReady-<date>.json -HistoryPath Logs\Reports\PortBatchHistory.csv` to append the analyzer results to the trend CSV so regressions are obvious.
- `pwsh Tools\Analyze-InterfaceSyncTiming.ps1 -Path Logs\IngestionMetrics\<file>.json -OutputPath Logs\Reports\InterfaceSyncTiming-<date>.json -TopHosts 15` to identify high UiClone/StreamDispatch p95 hosts and per-site hot spots; capture the JSON + top-host table in Plan D notes.
- `pwsh Tools\Update-InterfaceSyncHistory.ps1 -ReportPaths Logs\Reports\InterfaceSyncTiming-<date>.json -HistoryPath Logs\Reports\InterfaceSyncHistory.csv` to track UiClone/StreamDispatch trends over time.
- `pwsh Tools\Analyze-PortBatchIntervals.ps1 -Path Logs\IngestionMetrics\<file>.json -TopIntervals 10 -ThresholdSeconds 60` to flag idle windows between batches; log any gaps > 60 seconds in the plan so follow-up (e.g., dispatcher/queue tuning) is prioritized.
- When authoring guided troubleshooting runbooks, pull sanitized incidents via Plan F (`Tools\Sanitize-PostmortemLogs.ps1`, `docs/StateTrace_IncidentPostmortem_Intake.md`), then document the telemetry commands in the runbook template before publishing.

## Telemetry gates
- Incremental loading: `PortBatchReady` emits one event per processed device (37 for BOYO/WLLS) and `InterfaceSyncTiming`/`DatabaseWriteLatency` stay within Plan A/B thresholds (see `docs/telemetry/Automation_Gates.md`); log counts + samples in the plan entry.
- SPAN view: `Get-SpanViewSnapshot` (or future telemetry event) must report `RowsBound > 0` for the requested host/site and log timestamps to `Logs/Debug/SpanDiag.log`; once telemetry events exist, add them to `docs/telemetry/Phase1_metrics.md` and enforce via this plan.
- Guided workflows/templates: each published workflow must include a verification command (per runbook template) and reference the telemetry it expects (e.g., `GuidedWorkflowCompletionRate`, once defined) before it ships.

## References & history
- Operator instructions: `docs/StateTrace_Operators_Runbook.md`.
- Feature catalogue: `docs/StateTrace_Functions_Features.md`.
- UI automation matrix: `docs/CODEX_PLAN_AUTOMATION_MATRIX.md`, `docs/CODEX_RUNBOOK.md`, `docs/UI_Smoke_Checklist.md`.
- Pending design work & session notes: `docs/notes/2025-11-07_span-view-investigation.md`, `docs/notes/2025-10-03_feature-expansion.md`.
- Span tooling references: `Tools/Invoke-SpanViewSmokeTest.ps1`, `Tools/Test-SpanViewBinding.ps1`, `Modules/Tests/SpanViewModule.Tests.ps1`.
- Sanitized incident intake dependency: `docs/StateTrace_IncidentPostmortem_Intake.md`, `docs/agents/Agent_Kickoff_Tasks.md`, Plan F backlog.



