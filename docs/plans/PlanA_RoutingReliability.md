# Plan A – Routing Reliability

## Objective
Guarantee that parser output, dispatcher queueing, and interface hydration stay in lockstep so operators always see the latest routing information in the UI. Plan A owns InterfaceSync timing, dispatcher health, queue depth, and regression coverage for port delivery.

## Current status (2025-11)
- Interface queue instrumentation (`InterfacePortQueueMetrics`, `InterfaceSyncTiming`) was restored in the 2025-10-15 fixes (see `docs/StateTrace_Consolidated_Plans.md` around 15:12-16:30 MT), and the Codex automation matrix now maps Plan A tasks to the dispatcher harness + pipeline reset commands (`docs/CODEX_PLAN_AUTOMATION_MATRIX.md`).
- Dispatcher latency is traced separately from parser persistence; queue build times remain under 30 ms, so remaining latency lives upstream (historical log 2025-10-15 16:45 MT). We still need a recurring validation to prove the harness results land in `Logs/IngestionMetrics/*.json`.
- Plan B progression on shared cache hydration affects first-host cold starts; Plan A owns verifying that routing telemetry (`InterfaceSyncTiming`, dispatcher metrics) reaches the UI immediately after parsing, even when cold hydrations are slow. Coordinate with Plan B when cache regressions (WLLS/BOYO) could mask routing telemetry.
- No automated alert currently watches `InterfacePortQueueMetrics.QueueDelayMs`; Plan A must wire the planned alert into `Tools/Invoke-StateTraceVerification.ps1` or the dispatcher harness so releases block when queue delay exceeds thresholds.
- Plan D’s incremental loading UX relies on Plan A telemetry; keep the plan in sync with `docs/StateTrace_Operators_Runbook.md` and ensure UI smoke steps reference the routing metrics captured here.

## Active work
| ID | Title | Owner | Status | Notes |
|----|-------|-------|--------|-------|
<!-- LANDMARK: ST-A-007 evidence update -->
<!-- LANDMARK: ST-A-007 latest pointer evidence -->
| ST-A-007 | Roadmap M2: Routing discovery baseline | PMO/Routing | Done - 2026-01-02 | Completed route definitions + telemetry inventory/gap analysis in `docs/StateTrace_Routing_DataArchitecture.md` and confirmed routing baseline + schema validation. Evidence: `Logs/Reports/RoutingDiscoveryBaseline-ST-A-007-20260102-163500.json`; `Logs/Reports/RoutingDiscoveryBaseline-latest.json`; `Logs/Reports/RoutingSchemas-ST-A-007-20260102-163500.json`; `Logs/Verification/RoutingDiscoveryBaseline-ST-A-007-20260102-163500.log`; `Logs/Verification/RoutingSchemas-ST-A-007-20260102-163500.log`; `Logs/Verification/AllChecks-ST-A-007-20260102-163500.log`; `Logs/Reports/DocSyncChecklist-ST-A-007-20260102-180900.json`. |
| ST-A-001 | Verify InterfaceSync timing completeness after recent parser refactors | Ingestion | Done - 2025-11-14 | 2025-11-14 pipeline replay + dispatcher sweep produced 384 InterfaceSyncTiming events with queue p95/p99 = 20.02/20.76 ms (sampled via Logs/IngestionMetrics/QueueDelaySummary-20251114.json). Tools\Invoke-StateTracePipeline.ps1 -VerifyTelemetryCompleteness -FailOnTelemetryMissing and Tools\Test-IncrementalTelemetryCompleteness.ps1 -RequirePortBatchReady -RequireInterfaceSync -RequireSchedulerLaunch now pass (PortBatchReady=128, ParserSchedulerLaunch=86, scheduler guard MaxObservedStreak=1). Analyzer outputs Logs/Reports/InterfaceSyncTiming-2025-11-14.json + Logs/Reports/ParserSchedulerLaunch-2025-11-14.json are appended to the history CSVs (Logs/Reports/PortBatchHistory.csv, Logs/Reports/InterfaceSyncHistory.csv, Logs/Reports/QueueDelayHistory.csv, Logs/Reports/ParserSchedulerHistory.csv) and summarized in docs/performance/IncrementalLoading_Report.md. Routed evidence bundle: Logs/IngestionMetrics/2025-11-14.json + telemetry README + history CSVs with the fairness pass. |
| ST-A-002 | Add alert when InterfacePortQueueMetrics queue delay >120 ms | Ingestion + Telemetry | Done - 2026-01-04 | Created `Tools\Test-QueueDelayThreshold.ps1` to assert queue delay thresholds: p95 ≤120 ms, p99 ≤200 ms, queue build p95 ≤150 ms. Auto-discovers queue summary and telemetry. Use `-FailOnThresholdExceeded` for CI. |
| ST-A-003 | Automate dispatcher harness evidence capture | Automation | Backlog | Document how to call `Tools\Invoke-InterfaceDispatchHarness.ps1` (parameters, expected output) in `docs/CODEX_RUNBOOK.md` and ensure every Plan A task records harness metrics + path to the generated `Logs/DispatchHarness/*.json`. |
| ST-A-004 | UI routing smoke alignment | UI / Ingestion | Backlog | Update `docs/UI_Smoke_Checklist.md` and `docs/StateTrace_Operators_Runbook.md` so routing verification steps (Interfaces tab refresh + metric sampling) reference this plan and capture `InterfaceSyncTiming` samples whenever incremental loading or parser changes land. |
| ST-A-005 | Dispatcher alert integration | Telemetry | In Progress | `Tools\Invoke-StateTraceVerification.ps1` now enforces `InterfacePortQueueMetrics.QueueBuildDelayMs` p95 ≤120 ms / p99 ≤200 ms (auto-detects the latest `Logs\IngestionMetrics\*.json`) and emits `QueueDelaySummary-20251230-210113.json`. 2025-11-13 run produced `QueueDelaySummary-20251113-114756.json` (3 samples, p95 24.87 ms). `Tools\Invoke-InterfaceDispatchHarness.ps1` raises when queue delay exceeds 200 ms—run it via `powershell.exe -STA` so dispatcher APIs are available. 2025-12-22: dispatch harness now flushes telemetry buffer so queue/stream metrics persist; scheduler telemetry now flushes at parse completion and the analyzer ignores synthesized events when real launches exist; `Logs\IngestionMetrics\QueueDelaySummary-2025-12-22.json` reports 20 samples (p95 25.60 ms).
| ST-A-006 | Evidence bundle linkage | Ingestion + PMO | Done - 2025-12-22 | After each dispatcher/pipeline run, deposit Logs/IngestionMetrics/<date>.json, the generated Logs/IngestionMetrics/QueueDelaySummary-20251230-210113.json, and dispatcher harness logs into Logs/TelemetryBundles/<bundle>/Routing/. Tools\Invoke-StateTracePipeline.ps1 now emits the queue delay summary automatically and appends queue, scheduler, port, and InterfaceSync history rows (Logs/Reports/QueueDelayHistory.csv, Logs/Reports/ParserSchedulerHistory.csv, Logs/Reports/PortBatchHistory.csv, Logs/Reports/InterfaceSyncHistory.csv), and Tools\Publish-TelemetryBundle.ps1 copies all four CSVs into the bundle so prep only requires copying the JSON + referencing the matching history row. 2025-12-22 bundle: Logs/TelemetryBundles/Routing-20251222/Routing/ (queue summary + dispatcher sweep + scheduler comparison). 2025-11-14 bundle: Logs/TelemetryBundles/Release-20251114/Routing/ (queue summary + WLLS/BOYO harness logs + routing sweep JSON + doc-sync evidence, readiness verified). |
| ST-A-008 | Routing discovery host list baseline summary | PMO/Routing | Done - 2025-12-27 | Added `Tools\Test-RoutingDiscoveryBaseline.ps1` to validate `Data\RoutingHosts.txt` + `Data\RoutingHosts_Balanced.txt`, emit `Logs/Reports/RoutingDiscoveryBaseline-20251227-164439.json`, and update `Logs/Reports/RoutingDiscoveryBaseline-latest.json` for routing discovery baselines. |
| ST-A-009 | Routing schemas + validator | PMO/Routing | Done - 2025-12-27 | Added routing schema docs + JSON schema artifacts (RouteRecord/RouteHealthSnapshot), fixtures, and validator `Tools/Test-RoutingSchemas.ps1` emitting `Logs/Reports/RoutingSchemas-ST-A-009-20251227-184209.json`. |
| ST-A-010 | Routing discovery capture conversion | PMO/Routing | Done - 2025-12-27 | Added RoutingDiscoveryCapture schema + fixture, conversion tool `Tools/Convert-RoutingDiscoveryCapture.ps1` to emit RouteRecord arrays, and Pester coverage. Evidence: `Logs/Reports/RoutingDiscoveryConversion-ST-A-010-20251227-191759.json`. |
| ST-A-011 | Route health snapshot generator | PMO/Routing | Done - 2025-12-28 | Added `Tools/Convert-RouteRecordsToHealthSnapshot.ps1` with v1 health rules, fixtures (`Tests/Fixtures/Routing/RouteRecords.sample.json`, `Tests/Fixtures/Routing/RouteHealthSnapshot.expected.json`), and Pester coverage. Evidence: `Logs/Reports/RouteHealthSnapshotSummary-ST-A-011-20251228-162943.json`; `Logs/Reports/RouteHealthSnapshot-ST-A-011-20251228-162943.json`; `Logs/Verification/RouteHealthSnapshot-ST-A-011-20251228-162943.log`; `Logs/Verification/AllChecks-ST-A-011-20251228-163841.log`; `Logs/Reports/DocSyncChecklist-ST-A-011-20251228-164056.json`. |
| ST-A-012 | Offline routing discovery pipeline runner | PMO/Routing | Done - 2025-12-29 | Added `Tools/Invoke-RoutingDiscoveryPipeline.ps1` to orchestrate RoutingDiscoveryCapture -> RouteRecords -> RouteHealthSnapshot with schema validation, summary JSON, and latest pointer under `Logs/Reports/RoutingDiscoveryPipeline/`. Evidence: `Logs/Reports/RoutingDiscoveryPipeline/RoutingDiscoveryPipelineSummary-20251229-111024.json`; `Logs/Reports/RoutingDiscoveryPipeline/RoutingDiscoveryPipelineSummary-latest.json`; `Logs/Verification/RoutingDiscoveryPipeline-ST-A-012-20251229-111024.log`; `Logs/Verification/AllChecks-ST-A-012-20251229-111105.log`; `Logs/Reports/DocSyncChecklist-ST-A-012-20251229-111646.json`. |
| ST-A-013 | Routing CLI capture ingestion | PMO/Routing | Done - 2025-12-29 | Added RoutingCliCapture v1 schema + Cisco IOS-XE fixtures plus converter `Tools/Convert-RoutingCliCaptureToDiscoveryCapture.ps1` to emit RoutingDiscoveryCapture JSON + summary. Evidence: `docs/schemas/routing/RoutingCliCapture.md`; `docs/schemas/routing/routing_cli_capture.schema.json`; `Tests/Fixtures/Routing/CliCapture/CiscoIOSXE/Capture.json`; `Tests/Fixtures/Routing/CliCapture/CiscoIOSXE/show_ip_route.txt`; `Logs/Reports/RoutingCliIngestionSummary-ST-A-013-20251229-114108.json`; `Logs/Reports/RoutingDiscoveryCapture-ST-A-013-20251229-114108.json`; `Logs/Reports/RoutingDiscoveryPipeline/CliIngest-ST-A-013/RoutingDiscoveryPipelineSummary-20251229-114119.json`; `Logs/Verification/RoutingDiscoveryPipeline-ST-A-013-20251229-114119.log`; `Logs/Verification/AllChecks-ST-A-013-20251229-114208.log`; `Logs/Reports/DocSyncChecklist-ST-A-013-20251229-114527.json`. |
| ST-A-014 | Routing CLI capture session runner | PMO/Routing | Done - 2025-12-29 | Added RoutingCliCaptureSession v1 schema + offline session runner `Tools/Invoke-RoutingCliCaptureSession.ps1` to emit per-host RoutingCliCapture bundles with session summary + latest pointer. Evidence: `docs/schemas/routing/RoutingCliCaptureSession.md`; `docs/schemas/routing/routing_cli_capture_session.schema.json`; `Tests/Fixtures/Routing/CliCaptureSession/CiscoIOSXE/Session.json`; `Logs/Reports/RoutingCliCaptureSession/RoutingCliCaptureSessionSummary-20251229-120524.json`; `Logs/Reports/RoutingCliCaptureSession/RoutingCliCaptureSessionSummary-latest.json`; `Logs/Reports/RoutingCliIngestionSummary-ST-A-014-20251229-120536.json`; `Logs/Reports/RoutingDiscoveryPipeline/CliSession-ST-A-014/RoutingDiscoveryPipelineSummary-20251229-120547.json`; `Logs/Verification/RoutingCliCaptureSession-ST-A-014-20251229-120524.log`; `Logs/Verification/AllChecks-ST-A-014-20251229-120555.log`; `Logs/Reports/DocSyncChecklist-ST-A-014-20251229-121125.json`. |
| ST-A-015 | Routing CLI capture session online mode | PMO/Routing | Done - 2025-12-29 | Added online mode to `Tools/Invoke-RoutingCliCaptureSession.ps1` gated by `STATETRACE_ALLOW_NETWORK_CAPTURE=1` + `-AllowNetworkCapture`, key-based SSH only, with a simulation hook for offline validation. Evidence: `docs/schemas/routing/RoutingCliCaptureSession.md`; `Logs/Reports/RoutingCliCaptureSession/RoutingCliCaptureSessionSummary-20251229-123436.json`; `Logs/Reports/RoutingCliCaptureSession/RoutingCliCaptureSessionSummary-latest.json`; `Logs/Reports/RoutingCliIngestionSummary-ST-A-015-20251229-123448.json`; `Logs/Reports/RoutingDiscoveryPipeline/CliSession-ST-A-015/RoutingDiscoveryPipelineSummary-20251229-123507.json`; `Logs/Verification/RoutingCliCaptureSession-ONLINE-ST-A-015-20251229-123436.log`; `Logs/Verification/RoutingCliIngestion-ST-A-015-20251229-123448.log`; `Logs/Verification/RoutingDiscoveryPipeline-ST-A-015-20251229-123507.log`; `Logs/Verification/AllChecks-ST-A-015-20251229-123515.log`; `Logs/Reports/DocSyncChecklist-ST-A-015-20251229-124200.json`. |
| ST-A-016 | Routing online capture readiness preflight | PMO/Routing | Done - 2025-12-29 | Added `Tools/Test-RoutingOnlineCaptureReadiness.ps1` to validate RoutingCliCaptureSession manifests offline (vendor support, transcript path safety, SSH readiness, and gating guidance) and emit readiness JSON with recommended commands. Runbook updated with the operator checklist. Evidence: `Logs/Reports/RoutingOnlineCaptureReadiness-ST-A-016-20251229-131931.json`; `Logs/Verification/RoutingOnlineCaptureReadiness-ST-A-016-20251229-131931.log`; `Logs/Verification/AllChecks-ST-A-016-20251229-131940.log`; `Logs/Reports/DocSyncChecklist-ST-A-016-20251229-132319.json`. |
| ST-A-017 | AristaEOS CLI capture ingestion support | PMO/Routing | Done - 2025-12-29 | Added AristaEOS parsing support for routing CLI capture ingestion plus fixtures/tests (`Tests/Fixtures/Routing/CliCapture/AristaEOS`). Evidence: `Logs/Reports/RoutingCliIngestionSummary-ST-A-017-20251229-135108.json`; `Logs/Reports/RoutingDiscoveryCapture-ST-A-017-20251229-135108.json`; `Logs/Reports/RoutingDiscoveryPipeline/CliIngest-ST-A-017/RoutingDiscoveryPipelineSummary-20251229-135108.json`; `Logs/Verification/RoutingCliIngestion-ST-A-017-20251229-135108.log`; `Logs/Verification/RoutingDiscoveryPipeline-ST-A-017-20251229-135108.log`; `Logs/Verification/AllChecks-ST-A-017-20251229-135726.log`; `Logs/Reports/DocSyncChecklist-ST-A-017-20251229-135400.json`. |
| ST-A-018 | Routing validation orchestrator | PMO/Routing | Done - 2025-12-29 | Added `Tools/Invoke-RoutingValidationRun.ps1` to orchestrate preflight + capture + ingest + pipeline with a single summary + latest pointer (offline + simulated online). Evidence: `Logs/Reports/RoutingValidationRun/Run-20251229-150000/RoutingValidationRunSummary-20251229-150000.json`; `Logs/Reports/RoutingValidationRun/Run-20251229-150100/RoutingValidationRunSummary-20251229-150100.json`; `Logs/Reports/RoutingValidationRun/RoutingValidationRunSummary-latest.json`; `Logs/Verification/RoutingValidationRun-ST-A-018-OFFLINE-20251229-150000.log`; `Logs/Verification/RoutingValidationRun-ST-A-018-ONLINE-SIM-20251229-150100.log`; `Logs/Verification/AllChecks-ST-A-018-20251229-142300.log`; `Logs/Reports/DocSyncChecklist-ST-A-018-20251229-142900.json`. |
| ST-A-019 | Operator routing validation evidence | PMO/Routing | Backlog (Deferred/out-of-scope) | Real-device routing validation using `Tools/Invoke-RoutingValidationRun.ps1` (online mode) is deferred for the current offline-only phase. Follow `docs/runbooks/Routing_RealDeviceValidation.md` when device access is approved; capture evidence with `docs/templates/Routing_RealDeviceEvidence.md`, then validate using `Tools/Test-RoutingRealDeviceEvidence.ps1`. |
| ST-A-020 | Routing real-device evidence validator | PMO/Routing | Done - 2025-12-29 | Added `Tools/Test-RoutingRealDeviceEvidence.ps1` to parse operator evidence markdown, verify artifact paths, detect routing validation summaries, and emit a JSON evidence record + latest pointer. Evidence: `Logs/Reports/RoutingRealDeviceEvidence/RoutingRealDeviceEvidence-ST-A-020-20251229-151914.json`; `Logs/Reports/RoutingRealDeviceEvidence/RoutingRealDeviceEvidence-latest.json`; `Logs/Verification/RoutingRealDeviceEvidence-ST-A-020-20251229-151914.log`; `Logs/Verification/AllChecks-ST-A-020-20251229-151932.log`; `Logs/Reports/DocSyncChecklist-ST-A-020-20251229-152350.json`. |
| ST-A-021 | Routing data architecture notes | PMO/Routing | Done - 2025-12-29 | Published `docs/StateTrace_Routing_DataArchitecture.md` with contracts, tooling map, modes, and governance. Evidence: `Logs/Verification/AllChecks-ST-A-021-20251229-162623.log`; `Logs/Reports/DocSyncChecklist-ST-A-021-20251229-163239.json`. |
| ST-A-022 | Routing quickstart runbook | PMO/Routing | Done - 2025-12-29 | Added docs/runbooks/Routing_QuickStart.md with offline/simulated/online commands and evidence closure steps, cross-linked from runbooks and architecture. Evidence: Logs/Verification/AllChecks-ST-A-022-20251229-164702.log; Logs/Reports/DocSyncChecklist-ST-A-022-20251229-164702.json. |
| ST-A-023 | Routing CLI capture session manifest generator | PMO/Routing | Done - 2025-12-29 | Added Tools/New-RoutingCliCaptureSession.ps1 to build RoutingCliCaptureSession manifests from host lists deterministically (offline-only). Evidence: Logs/Reports/RoutingCliCaptureSessionManifests/RoutingCliCaptureSession-ST-A-023-20251229-170539.json; Logs/Verification/RoutingCliCaptureSessionGenerator-ST-A-023-20251229-170539.log; Logs/Verification/AllChecks-ST-A-023-20251229-170949.log; Logs/Reports/DocSyncChecklist-ST-A-023-20251229-171605.json. |
| ST-A-024 | Offline routing log viewer | PMO/Routing | Done - 2025-12-29 | Added offline routing log viewer `Tools/Show-RoutingLogSummary.ps1` for routing validation and pipeline summaries (console/markdown/csv). Evidence: Logs/Reports/RoutingLogViewer/RoutingLogViewer-ST-A-024-20251229-175220.md; Logs/Verification/RoutingLogViewer-ST-A-024-20251229-175220.log; Logs/Verification/AllChecks-ST-A-024-20251229-175320.log; Logs/Reports/DocSyncChecklist-ST-A-024-20251229-175559.json. |
| ST-A-025 | Routing log index (offline) | PMO/Routing | Done - 2025-12-30 | Added offline routing log indexer `Tools/Build-RoutingLogIndex.ps1` for routing validation/pipeline/evidence summaries with deterministic latest pointer. Evidence: Logs/Reports/RoutingLogIndex/RoutingLogIndex-ST-A-025-20251230-153133.json; Logs/Reports/RoutingLogIndex/RoutingLogIndex-latest.json; Logs/Verification/RoutingLogIndex-ST-A-025-20251230-153133.log; Logs/Verification/AllChecks-ST-A-025-20251230-153153.log; Logs/Reports/DocSyncChecklist-ST-A-025-20251230-153439.json. |
| ST-A-026 | Offline routing log explorer | PMO/Routing | Done - 2025-12-30 | Added offline routing log explorer `Tools/Invoke-RoutingLogExplorer.ps1` to list/filter/select routing summaries from the routing log index with markdown reporting; QuickStart updated with Explore Logs (Offline) guidance (`docs/runbooks/Routing_QuickStart.md`). Evidence: Logs/Reports/RoutingLogExplorer/RoutingLogExplorer-ST-A-026-20251230-162031.md; Logs/Verification/RoutingLogExplorer-ST-A-026-20251230-162031.log; Logs/Verification/AllChecks-ST-A-026-20251230-161901.log; Logs/Reports/DocSyncChecklist-ST-A-026-20251230-162203.json. |
| ST-A-027 | Offline routing run diff | PMO/Routing | Done - 2025-12-30 | Added offline diff tool `Tools/Compare-RouteHealthSnapshots.ps1` to compare RouteHealthSnapshot outputs (optional RouteRecords enrichment) with JSON + markdown reporting; QuickStart updated with Compare Two Runs (Offline) guidance (`docs/runbooks/Routing_QuickStart.md`). Evidence: Logs/Reports/RoutingDiff/RoutingDiff-ST-A-027-20251230-170756.json; Logs/Reports/RoutingDiff/RoutingDiff-ST-A-027-20251230-170756.md; Logs/Verification/RoutingDiff-ST-A-027-20251230-170756.log; Logs/Verification/AllChecks-ST-A-027-20251230-170808.log; Logs/Reports/DocSyncChecklist-ST-A-027-20251230-171418.json. |
| ST-A-028 | Explorer compare mode (offline) | PMO/Routing | Done - 2025-12-30 | Added explorer compare mode in `Tools/Invoke-RoutingLogExplorer.ps1` to diff the selected summary against the previous run for the same target (offline-only) and emit routing diff outputs; QuickStart updated with Compare Latest Two Runs (Offline) guidance (`docs/runbooks/Routing_QuickStart.md`). Evidence: Logs/Reports/RoutingDiff/RoutingDiff-ST-A-028-20251230-191006.json; Logs/Reports/RoutingDiff/RoutingDiff-ST-A-028-20251230-191006.md; Logs/Verification/RoutingExplorerCompare-ST-A-028-20251230-191006.log; Logs/Verification/AllChecks-ST-A-028-20251230-190653.log; Logs/Reports/DocSyncChecklist-ST-A-028-20251230-191601.json. |
| ST-A-029 | Explorer ergonomics: Hostname filter + CompareLatestTwo | PMO/Routing | Done - 2025-12-30 | Added Hostname filtering, Latest selection, and CompareLatestTwo ergonomics to `Tools/Invoke-RoutingLogExplorer.ps1` (offline-only); QuickStart/runbook updated with Hostname/Latest/CompareLatestTwo examples. Evidence: Logs/Reports/RoutingDiff/RoutingDiff-ST-A-029-20251230-204658.json; Logs/Reports/RoutingDiff/RoutingDiff-ST-A-029-20251230-204658.md; Logs/Verification/RoutingExplorerLatestCompare-ST-A-029-20251230-204658.log; Logs/Verification/AllChecks-ST-A-029-20251230-205539.log; Logs/Reports/DocSyncChecklist-ST-A-029-20251230-210113.json. |
| ST-A-030 | Offline routing bundle exporter (ZIP) | PMO/Routing | Done - 2025-12-31 | Added `Tools/Export-RoutingOfflineBundle.ps1` to package routing summaries/diffs plus referenced artifacts into offline zip bundles with manifest + latest pointer; QuickStart/runbook updated with export guidance (offline-only). Evidence: Logs/Reports/RoutingBundles/RoutingBundle-ST-A-030-20251231-074532.zip; Logs/Reports/RoutingBundles/RoutingBundle-ST-A-030-20251231-074532.json; Logs/Reports/RoutingBundles/RoutingBundle-latest.json; Logs/Verification/RoutingBundleExport-ST-A-030-20251231-074532.log; Logs/Verification/AllChecks-ST-A-030-20251231-074928.log; Logs/Reports/DocSyncChecklist-ST-A-030-20251231-075308.json. |
| ST-A-031 | Explorer bundle export integration | PMO/Routing | Done - 2025-12-31 | Added bundle export integration to `Tools/Invoke-RoutingLogExplorer.ps1` for selected summaries and compare diffs (offline-only); QuickStart/runbook updated with explorer bundle export examples. Evidence: Logs/Reports/RoutingDiff/RoutingDiff-ST-A-031-20251231-083930.json; Logs/Reports/RoutingDiff/RoutingDiff-ST-A-031-20251231-083930.md; Logs/Reports/RoutingBundles/RoutingBundle-Diff-ST-A-031-20251231-083930.zip; Logs/Verification/RoutingExplorerBundle-ST-A-031-20251231-083930.log; Logs/Verification/AllChecks-ST-A-031-20251231-083942.log; Logs/Reports/DocSyncChecklist-ST-A-031-20251231-084508.json. |
| ST-A-032 | Routing offline bundle validation | PMO/Routing | Done - 2025-12-31 | Added `Tools/Test-RoutingOfflineBundle.ps1` to validate routing bundle zips (manifest presence, path safety, SHA256/byte counts) and emit validation JSON with latest pointer; QuickStart/runbook updated with offline bundle validation guidance. Evidence: Logs/Reports/RoutingBundles/RoutingBundleValidation-ST-A-032-20251231-090551.json; Logs/Reports/RoutingBundles/RoutingBundleValidation-latest.json; Logs/Verification/RoutingBundleValidation-ST-A-032-20251231-090551.log; Logs/Verification/AllChecks-ST-A-032-20251231-090618.log; Logs/Reports/DocSyncChecklist-ST-A-032-20251231-091232.json. |
| ST-A-033 | Routing offline bundle extractor | PMO/Routing | Done - 2025-12-31 | Added `Tools/Expand-RoutingOfflineBundle.ps1` to validate and safely extract routing bundles into offline workspaces with summary + latest pointer; QuickStart/runbook updated with bundle review steps (offline-only). Evidence: Logs/Reports/RoutingBundles/RoutingBundleExpanded-ST-A-033-20251231-093917.json; Logs/Reports/RoutingBundles/RoutingBundleExpanded-latest.json; Logs/Reports/RoutingBundles/RoutingBundleValidation-ST-A-033-20251231-093917.json; Logs/Verification/RoutingBundleExpand-ST-A-033-20251231-093917.log; Logs/Verification/AllChecks-ST-A-033-20251231-093927.log; Logs/Reports/DocSyncChecklist-ST-A-033-20251231-094537.json. |
| ST-A-034 | Routing bundle review orchestrator | PMO/Routing | Done - 2025-12-31 | Added `Tools/Invoke-RoutingBundleReview.ps1` to orchestrate offline bundle validation, safe expansion, primary summary discovery, and optional index/render outputs under a workspace; QuickStart/runbook updated with the single-command review flow (offline-only). Evidence: Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-034-20251231-100902/Outputs/RoutingBundleReview-20251231-100903.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-034-20251231-100902/Outputs/RoutingBundleExpandedSummary-20251231-100903.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-034-20251231-100902/Outputs/RoutingBundleValidation-20251231-100903.json; Logs/Reports/RoutingBundles/RoutingBundleReview-latest.json; Logs/Verification/RoutingBundleReview-ST-A-034-20251231-100902.log; Logs/Verification/AllChecks-ST-A-034-20251231-100926.log; Logs/Reports/DocSyncChecklist-ST-A-034-20251231-101343.json. |
| ST-A-035 | RoutingDiff support across index + renderer + bundle review | PMO/Routing | Done - 2025-12-31 | Added RoutingDiff support in `Tools/Build-RoutingLogIndex.ps1`, `Tools/Show-RoutingLogSummary.ps1`, and `Tools/Invoke-RoutingBundleReview.ps1` so diff summaries index and render cleanly in bundles (offline-only). Evidence: Logs/Reports/RoutingDiff/RoutingDiff-ST-A-035-20251231-105935-Rendered.md; Logs/Verification/RoutingDiffRender-ST-A-035-20251231-105935.log; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-035-20251231-110233/Outputs/RoutingBundleReview-20251231-110242.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-035-20251231-110233/Outputs/RoutingBundleExpandedSummary-20251231-110242.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-035-20251231-110233/Outputs/RoutingBundleValidation-20251231-110242.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-035-20251231-110233/Outputs/RoutingLogIndex-20251231-110242.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-035-20251231-110233/Outputs/RoutingBundlePrimarySummary-20251231-110242.md; Logs/Reports/RoutingBundles/RoutingBundleReview-latest.json; Logs/Verification/RoutingBundleReview-ST-A-035-20251231-110233.log; Logs/Verification/AllChecks-ST-A-035-20251231-111142.log; Logs/Reports/DocSyncChecklist-ST-A-035-20251231-110745.json. |
| ST-A-036 | Bundle review ergonomics (workspace latest pointers + explorer command) | PMO/Routing | Done - 2025-12-31 | Workspace-local latest pointers for bundle review outputs plus explorer next-command emission; keep offline-only scope notes generic. Evidence: Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-036-20251231-115726/Outputs/RoutingBundleReview-20251231-115727.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-036-20251231-115726/Outputs/RoutingBundleExpandedSummary-20251231-115727.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-036-20251231-115726/Outputs/RoutingBundleValidation-20251231-115727.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-036-20251231-115726/Outputs/RoutingLogIndex-20251231-115727.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-036-20251231-115726/Outputs/RoutingLogIndex-latest.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-036-20251231-115726/Outputs/RoutingBundlePrimarySummary-20251231-115727.md; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-036-20251231-115726/Outputs/RoutingBundlePrimarySummary-latest.md; Logs/Reports/RoutingBundles/RoutingBundleReview-latest.json; Logs/Verification/RoutingBundleReview-ST-A-036-20251231-115726.log; Logs/Verification/AllChecks-ST-A-036-20251231-120250.log; Logs/Reports/DocSyncChecklist-ST-A-036-20251231-121216.json. |
| ST-A-037 | Bundle review one-step explorer run | PMO/Routing | Done - 2025-12-31 | Add -RunExplorer to bundle review to run the explorer and emit workspace explorer markdown/log outputs (offline-only). Evidence: Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingBundleReview-20251231-123146.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingBundleExpandedSummary-20251231-123146.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingBundleValidation-20251231-123146.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingLogIndex-20251231-123146.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingLogIndex-latest.json; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingBundlePrimarySummary-20251231-123146.md; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingBundlePrimarySummary-latest.md; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingLogExplorer-latest.md; Logs/Reports/RoutingBundles/Review/BundleReview-ST-A-037-20251231-123145/Outputs/RoutingLogExplorer-latest.log; Logs/Reports/RoutingBundles/RoutingBundleReview-latest.json; Logs/Verification/RoutingBundleReview-ST-A-037-20251231-123145.log; Logs/Verification/AllChecks-ST-A-037-20251231-123159.log; Logs/Reports/DocSyncChecklist-ST-A-037-20251231-123631.json. |
| ST-A-038 | Offline routing demo runner (fixtures diff bundle review explorer) | PMO/Routing | Done - 2025-12-31 | Offline demo runner that exercises diff + bundle + review + explorer with deterministic outputs (fixtures only). Evidence: Logs/Reports/RoutingOfflineDemo/Run-20251231-132935/RoutingOfflineDemoSummary-20251231-132935.json; Logs/Reports/RoutingOfflineDemo/RoutingOfflineDemoSummary-latest.json; Logs/Verification/RoutingOfflineDemo-ST-A-038-20251231-132934.log; Logs/Verification/AllChecks-ST-A-038-20251231-132650.log; Logs/Reports/DocSyncChecklist-ST-A-038-20251231-133242.json. |

## Near-term execution detail

### ST-A-005 — Queue delay guardrails
- **Status (2025-11-13):** `Tools\Invoke-StateTraceVerification.ps1` now auto-loads the latest `Logs\IngestionMetrics\<date>.json`, parses `InterfacePortQueueMetrics` events, and fails when `QueueBuildDelayMs` p95 exceeds 120 ms or p99 exceeds 200 ms. The dispatcher harness mirrors the guard (`-QueueDelayWarningMs 120 -QueueDelayCriticalMs 200`) so single-host replays surface regressions even without the full pipeline.
- **Verification wiring:** `Tools\Invoke-StateTraceVerification.ps1` auto-discovers the latest `Logs\IngestionMetrics/<date>.json`, parses `InterfacePortQueueMetrics` (a.k.a. `QueueBuildDelayMs`), and fails the run when p95 > 120 ms or p99 > 200 ms. Supply `-QueueMetricsPath` when replaying historical telemetry. The dispatcher harness surfaces the same guard via `-QueueDelayWarningMs`/`-QueueDelayCriticalMs`.
- **Automation gates:** `docs/telemetry/Automation_Gates.md#plan-a` lists the 120/200 ms targets and the Codex automation matrix now calls out the same guard. If thresholds change, update both docs plus the verification script defaults so Plan E rollups stay aligned.
- **Regression evidence:** When the guard triggers, capture the failing JSON snippet plus the dispatcher harness output under `Logs\DispatchHarness\DispatcherMetrics-20251230-210113.json`. Reference both paths when filing/closing TaskBoard rows ST-A-005/ST-A-006 and in the session log noted in `docs/CODEX_DOC_SYNC_PLAYBOOK.md`.
- **Doc + test hooks:** Add/extend tests in `Modules/Tests/VerificationModule.Tests.ps1` to assert the new guard, and call out the change in `docs/README.md` so operators know the harness now enforces queue delay. Update the UI smoke checklist entry that references routing latency so the manual backup procedure matches the guardrail.

### ST-A-001 - Host coverage + shared-cache coupling
- **Host census:** Keep `Data/RoutingHosts.txt` authoritative by comparing it with the CMDB export before each dispatcher sweep. The file now captures all 37 WLLS/BOYO hosts pulled from the 2025-11-13 telemetry, and `Tools\New-BalancedRoutingHostList.ps1` regenerates both the canonical list and the segmented rotation in `Data/RoutingHosts_Balanced.txt`. Document any delta (added/removed hosts, mismatched casing) inside TaskBoard row ST-A-001 so auditors can prove coverage.
- **Queue sweep recipe:** `Tools\Invoke-RoutingQueueSweep.ps1 -UseBalancedHostOrder -QueueDelayWarningMs 120 -QueueDelayCriticalMs 200 -OutputDirectory Logs\DispatchHarness` shells out to `powershell.exe -STA` per host, producing per-host logs plus `Logs\DispatchHarness\RoutingQueueSweep-20251230-210113.json`. When `Data/RoutingHosts_Balanced.txt` exists the script consumes it as-is (no rebalancing), so the harness follows the same round-robin order we advertise to UI/runtime teams. Pass `-Verbose` when isolating stragglers so Dispatcher API traces are preserved.
- **Evidence stitching:** After every sweep, capture (1) the JSON summary, (2) at least the slowest-host transcript, and (3) the matching `Logs\IngestionMetrics\QueueDelaySummary-20251230-210113.json`. Reference all three paths in this plan’s timeline plus `docs/StateTrace_TaskBoard.md`, then drop them into the routing telemetry bundle (ST-A-006) so Plan G can review a single artifact.
- **Shared-cache alignment:** Once Plan B publishes a healthy shared-cache snapshot, re-run the queue sweep immediately after `Tools\Invoke-StateTraceVerification.ps1 -SkipSharedCacheSummaryEvaluation:$false` so routing and cache telemetry share a bundle. Call this out in `docs/CODEX_PLAN_AUTOMATION_MATRIX.md` if additional parameters (e.g., `-SharedCacheRequiredSites`) are used.

### ST-A-006 - Routing evidence bundling
- **Bundle schema:** All dispatcher/pipeline evidence must land in `Logs\TelemetryBundles/<bundle>/Routing/` with a README that lists: commands executed, host/site coverage, queue-delay stats, `InterfaceSyncTiming` counts, and the TaskBoard IDs touched (ST-A-001 through ST-A-006). Reuse `Tools\Publish-TelemetryBundle.ps1 -AreaName Routing` so manifests/hashes stay aligned with Plan E ST-E-009 expectations.
- **Drop artifacts:** Minimum files per bundle: `Logs\IngestionMetrics\<run>.json`, dispatcher harness CSV/JSON output, the generated `Logs\IngestionMetrics\QueueDelaySummary-20251230-210113.json` (and `QueueDelaySummary-latest.json` pointer), queue delay chart (`DispatcherQueueDelay-20251230-210113.png` if generated), routing sweep JSON + slowest-host transcript, and the doc-sync checklist export proving Plan A + TaskBoard + backlog updates occurred. Link these paths back into `docs/StateTrace_TaskBoard.md` rows ST-A-005/ST-A-006.
- **Release gating:** Note in `docs/Release.md` (via Plan G) that routing bundles are a hard precondition for release sign-off and call out ST-G-007 as the consumer task. Until Plan G automation lands, add a manual checklist item under this plan's "Automation hooks" reminding release drivers to verify the `Routing/` area exists in the current telemetry bundle.
- **Audit trail:** Record bundle hashes + README excerpts in `docs/CODEX_RUNBOOK.md` (Plan A section) to make it obvious how to regenerate evidence during incident reviews. Also keep a running list of bundle folders in this plan's timeline with MT timestamps so auditors can trace when routing evidence was produced relative to parser changes.

## Recent timeline (migrated from consolidated log)
| Date (MT) | Summary | Metrics / Artifacts | Source |
|-----------|---------|---------------------|--------|
| 2025-12-22 07:47 | Cleared ingestion history, reran the pipeline + dispatcher sweep to repopulate queue/stream telemetry, then regenerated the diversity + scheduler comparisons using synthesized PortBatchReady events. | `Logs/IngestionMetrics/2025-12-22.json`, `Logs/IngestionMetrics/QueueDelaySummary-2025-12-22.json`, `Logs/Reports/PortBatchSiteDiversity-2025-12-22.json`, `Logs/Reports/ParserSchedulerLaunch-2025-12-22.json`, `Logs/Reports/SchedulerVsPortDiversity-2025-12-22.json`. | docs/agents/sessions/2025-12-22_session-0003.md |
| 2025-12-22 08:10 | Pipeline rerun refreshed queue + interface summaries (PortBatchReady/InterfaceSyncTiming), but the scheduler fairness guard failed (BOYO max streak 11) and aborted the pipeline. | `Logs/IngestionMetrics/2025-12-22.json`, `Logs/IngestionMetrics/QueueDelaySummary-2025-12-22.json`, `Logs/Reports/PortBatchReady-2025-12-22.json`, `Logs/Reports/InterfaceSyncTiming-2025-12-22.json`, `Logs/Reports/PortBatchSiteDiversity-2025-12-22.json`, `Logs/Reports/ParserSchedulerLaunch-2025-12-22.json`. | docs/agents/sessions/2025-12-22_session-0003.md |
| 2025-12-22 08:34 | Pipeline rerun captured real scheduler launch telemetry and passed fairness (max streak 1); scheduler vs. port diversity comparison now clean. | `Logs/IngestionMetrics/2025-12-22.json`, `Logs/IngestionMetrics/QueueDelaySummary-2025-12-22.json`, `Logs/Reports/ParserSchedulerLaunch-2025-12-22.json`, `Logs/Reports/SchedulerVsPortDiversity-2025-12-22.json`, `docs/performance/SchedulerVsPortDiversity-2025-12-22.md`. | docs/agents/sessions/2025-12-22_session-0003.md |
| 2025-12-22 08:50 | Published routing evidence bundle with dispatcher sweep + queue delay summary. | `Logs/TelemetryBundles/Routing-20251222/Routing/`, `Logs/DispatchHarness/RoutingQueueSweep-checklist-20251222-074214.json`, `Logs/IngestionMetrics/QueueDelaySummary-2025-12-22.json`. | docs/agents/sessions/2025-12-22_session-0004.md |
| 2025-11-13 11:47 | Trimmed legacy debug logs, reran the verification harness (skip parsing) plus dispatcher harness for WLLS-A01-AS-01 and BOYO-A05-AS-05 via `powershell.exe -STA`, and captured the queue-delay summary (SampleCount=3, avg 20.48 ms, p95 24.87 ms, p99 25.26 ms). | `Logs/IngestionMetrics/2025-11-13.json`, `Logs/IngestionMetrics/QueueDelaySummary-20251113-114756.json`, dispatcher harness console log. | Tools/Invoke-StateTraceVerification.ps1, Tools/Invoke-InterfaceDispatchHarness.ps1 |
| 2025-11-13 11:50 | Published the routing evidence bundle (`Logs/TelemetryBundles/Routing-20251113/Routing/`) containing the queue summary JSON, dispatcher harness logs (WLLS/BOYO), and session log reference for ST-A-005/006. | `Tools\New-TelemetryBundle.ps1 -BundleName Routing-20251113 -AreaName Routing ...` output. | Logs/TelemetryBundles/Routing-20251113/Routing |
| 2025-11-13 12:05 | Ran `Tools\Invoke-RoutingQueueSweep.ps1 -HostListPath Data\RoutingHosts.txt` to collect queue metrics for the initial 17 BOYO/WLLS hosts (all <25 ms). Logs stored per host plus aggregate summary (`Logs\DispatchHarness\RoutingQueueSweep-20251113.json`). | `Logs\DispatchHarness\<host>-20251113-120508.log`, JSON summary with QueueDelay stats (avg 19-24 ms). | Tools/Invoke-RoutingQueueSweep.ps1 |
| 2025-11-14 07:55 | Expanded `Data/RoutingHosts.txt` (and the balanced variant) to all 37 BOYO/WLLS hosts via `Tools\New-BalancedRoutingHostList.ps1`, then ran `Tools\Invoke-RoutingQueueSweep.ps1 -UseBalancedHostOrder`. The new summary (`Logs\DispatchHarness\RoutingQueueSweep-20251114-balanced2.json` + per-host logs) shows queue delay <=32 ms and longest WLLS streak = 2, addressing the earlier starvation evidence referenced by Plan D. | `Logs\DispatchHarness\*\-20251114-075523.log`, `Logs\DispatchHarness\RoutingQueueSweep-20251114-balanced2.json`, doc `docs/performance/DispatchHarnessSweepOrder-20251114-balanced.md`. | Tools/Invoke-RoutingQueueSweep.ps1, Tools/New-BalancedRoutingHostList.ps1 |
| 2025-11-14 08:18 | Generated queue-delay summary and incremental-loading artifacts directly from telemetry via `Tools\Generate-QueueDelaySummary.ps1` + `Tools/Add-PortBatchReadyTelemetry.ps1`, then bundled the evidence under `Logs/TelemetryBundles/Release-20251114/Telemetry/`. Queue p95/p99 = 20.02/20.76 ms (128 samples). | `Logs/IngestionMetrics/QueueDelaySummary-20251114.json`, `Logs/Reports/PortBatchReady-20251114.json`, telemetry bundle README. | Tools/Add-PortBatchReadyTelemetry.ps1, Tools/Generate-QueueDelaySummary.ps1, Logs/TelemetryBundles/Release-20251114/Telemetry/ |
| 2025-11-14 10:32 | Verified incremental telemetry completeness for the routing bundle: `Tools\Test-IncrementalTelemetryCompleteness.ps1 -RequirePortBatchReady -RequireInterfaceSync -RequireSchedulerLaunch -ThrowOnMissing` reports PortBatchReady=128, InterfaceSyncTiming=384, ParserSchedulerLaunch=86 (scheduler analyzer now records MaxObservedStreak=1). Regenerated analyzer outputs (`Logs/Reports/PortBatchReady-2025-11-14.json`, `Logs/Reports/InterfaceSyncTiming-2025-11-14.json`, `Logs/Reports/ParserSchedulerLaunch-2025-11-14.json`), appended them to the history CSVs, and refreshed `docs/performance/IncrementalLoading_Report.md`. `Tools\Invoke-StateTracePipeline.ps1` now filters `Logs\IngestionMetrics` to ignore queue-summary JSON before selecting the latest telemetry file, automatically invokes the PortBatchReady/InterfaceSync/Scheduler analyzers, and appends queue, scheduler, port, and InterfaceSync history rows; `Tools\Publish-TelemetryBundle.ps1` copies all four CSVs into every routing bundle. | `Logs/IngestionMetrics/2025-11-14.json`, `Logs/IngestionMetrics/QueueDelaySummary-20251114.json`, `Logs/Reports/PortBatchHistory.csv`, `Logs/Reports/InterfaceSyncHistory.csv`, `Logs/Reports/QueueDelayHistory.csv`, `Logs/Reports/ParserSchedulerHistory.csv`, `docs/performance/IncrementalLoading_Report.md`. | Tools/Test-IncrementalTelemetryCompleteness.ps1, Tools/Invoke-StateTracePipeline.ps1, Tools/Analyze-PortBatchReadyTelemetry.ps1, Tools/Analyze-InterfaceSyncTiming.ps1, Tools/Analyze-ParserSchedulerLaunch.ps1, Tools/Publish-TelemetryBundle.ps1 |
| 2025-11-14 11:35 | Verified parser scheduler fairness on the incremental-loading replay: `Logs/Reports/ParserSchedulerLaunch-2025-11-14.json` now reports `MaxObservedStreak=1` after the guard + analyzer updates, so Plan A can cite that JSON (and the history CSV row) as the scheduler evidence for ST-A-001/ST-D-003. `Tools\Test-ParserSchedulerFairness.ps1` runs automatically because `Tools\Invoke-StateTracePipeline.ps1` now enables the guard by default and fails the run whenever streak violations surface. | `Logs/IngestionMetrics/2025-11-14.json`, `Logs/Reports/ParserSchedulerLaunch-2025-11-14.json`. | Tools/Invoke-StateTracePipeline.ps1, Tools/Analyze-ParserSchedulerLaunch.ps1, Tools/Test-ParserSchedulerFairness.ps1 |
| 2025-11-14 11:20 | Landed scheduler fairness guard: `ParserRunspaceModule\Invoke-DeviceParsingJobs` now tracks `MaxConsecutiveSiteLaunches` (default 8) so the parser loops hand alternate sites to the UI once the limit is hit, and `ParserWorker\Invoke-StateTraceParsing` exposes `-MaxConsecutiveSiteLaunchesOverride` (propagated through `Tools\Invoke-StateTracePipeline.ps1`). `ConcurrencyProfileResolved` now logs the resolved limit and telemetry bundles inherit the history CSVs so routing evidence includes the guard setting. Next telemetry run needs to confirm `ParserSchedulerLaunch-*.json` reports streak ≤8 and close ST-D-010/ST-A-006. | Modules/ParserRunspaceModule.psm1, Modules/ParserWorker.psm1, Tools/Invoke-StateTracePipeline.ps1, docs updates (README, CODEX_RUNBOOK, PlanB). | Parser fairness guard, scheduler telemetry. |
| 2025-11-13 09:55 | Verification harness enforces `InterfacePortQueueMetrics.QueueBuildDelayMs` p95 ≤120 ms / p99 ≤200 ms and dispatcher harness raises when queue delay >200 ms. | `Tools\Invoke-StateTraceVerification.ps1` queue gate output, `Tools\Invoke-InterfaceDispatchHarness.ps1 -QueueDelayCriticalMs 200` logs. | docs/CODEX_RUNBOOK.md, docs/telemetry/Automation_Gates.md |
| 2025-11-13 11:05 | Queue delay summary export + telemetry bundle hook added so every verification run produces `Logs/IngestionMetrics/QueueDelaySummary-20251230-210113.json`, and `Tools\Publish-TelemetryBundle.ps1 -AreaName Routing` auto-pulls the summary. | `Tools\Invoke-StateTraceVerification.ps1 -QueueDelaySummaryPath ...` output, telemetry bundle manifest showing `QueueDelaySummary*.json`. | Tools/Invoke-StateTraceVerification.ps1, Tools/Publish-TelemetryBundle.ps1 |
| 2025-10-15 15:12 | Identified missing `InterfaceSyncTiming` events and planned dispatcher/pipeline capture once emission path understood. | Telemetry gaps noted prior to patching `Update-InterfacesInDb`. | docs/StateTrace_Consolidated_Plans.md:4-5 |
| 2025-10-15 15:46 | Confirmed strict-mode `VariableIsUndefined` error in `Update-InterfacesInDb` prevented telemetry, queued fix + regression tests. | Root cause tied to uninitialised metrics in stream threads. | docs/StateTrace_Consolidated_Plans.md:7 |
| 2025-10-15 16:30 | Pipeline replay produced 37 `InterfaceSyncTiming` events with healthy stream metrics (Clone avg 22.2 ms/p95 53.7 ms, Dispatch avg 34.2 ms/p95 64.1 ms). | Command: `Tools/Invoke-StateTracePipeline.ps1 -SkipTests -VerboseParsing -ResetExtractedLogs`. | docs/StateTrace_Consolidated_Plans.md:8 |
| 2025-10-15 16:45 | Dispatcher harness showed queue build 18.9-26.5 ms, delay ≤103 ms, highlighting upstream InterfaceCall latency (1.5–10.5 s). | Data from `InterfacePortQueueMetrics` vs `DatabaseWriteBreakdown`. | docs/StateTrace_Consolidated_Plans.md:9 |
| 2025-10-15 17:05 | Added `SiteCacheFetchDurationMs`/`SiteCacheRefreshDurationMs` instrumentation mirrored into `DatabaseWriteBreakdown`; tests updated. | `Invoke-Pester Modules/Tests/ParserPersistenceModule.Tests.ps1` cover the new metrics. | docs/StateTrace_Consolidated_Plans.md:10 |
| 2025-11-13 | Routed telemetry bundles landed in Plans E/G by way of `Tools\New-TelemetryBundle.ps1`; Plan A now owns dispatcher alert integration + routing bundle drop-offs (ST-A-005/006). | Bundle README cites routing evidence + Plan A task IDs. | docs/plans/PlanE_Telemetry.md, docs/plans/PlanG_ReleaseGovernance.md |

## Automation hooks
- `Tools\Invoke-StateTracePipeline.ps1 -SkipTests -VerboseParsing -ResetExtractedLogs` (cold history) followed by `Tools\Invoke-WarmRunRegression.ps1 -VerboseParsing` to confirm routing telemetry persists across warm runs.
- `powershell.exe -NoLogo -STA -File Tools\Invoke-InterfaceDispatchHarness.ps1 -Hostname <host>` (run for the BOYO + WLLS corpus listed above) to replay dispatcher load and capture queue/append timings alongside the pipeline results (PowerShell 7 does not expose `System.Windows.Threading.Dispatcher`, so use Windows PowerShell with `-STA`).
- `Tools\Invoke-RoutingQueueSweep.ps1 -UseBalancedHostOrder -QueueDelayWarningMs 120 -QueueDelayCriticalMs 200` to orchestrate the dispatcher harness for multiple hosts with one command; the script shells out to `powershell.exe -STA`, logs to `Logs\DispatchHarness\<host>-20251230-210113.log`, and prints a queue-delay summary for each host. When the balanced lists are missing, pass `-HostListPath Data\RoutingHosts.txt` and `Tools\New-BalancedRoutingHostList.ps1` will rebuild them automatically.
- `Tools\Invoke-StateTraceVerification.ps1 -SharedCacheMinimumSiteCount 2 -SharedCacheRequiredSites BOYO,WLLS -EmitWarmRunTelemetry` whenever Plan A changes ship; the harness now auto-enforces `InterfacePortQueueMetrics.QueueBuildDelayMs` gates (use `-QueueMetricsPath` when replaying older telemetry, and only pass `-SkipQueueDelayEvaluation` when the absence of telemetry is documented). Every successful run writes `Logs\IngestionMetrics\QueueDelaySummary-20251230-210113.json` (override via `-QueueDelaySummaryPath`) for bundle evidence.
- Capture `Logs/IngestionMetrics/<date>.json` (InterfaceSyncTiming + InterfacePortQueueMetrics) and the dispatcher harness output; reference both paths in TaskBoard updates per `docs/CODEX_PLAN_AUTOMATION_MATRIX.md`.
- When Plan B publishes telemetry bundles (`Logs/TelemetryBundles/<date>/`), drop the routing JSON + dispatcher logs into the same folder so Plan G can confirm release readiness.

## Telemetry gates
- `InterfacePortQueueMetrics.QueueBuildDurationMs` average < 30 ms; `QueueBuildDelayMs` (a.k.a. `QueueDelayMs`) p95 ≤ 120 ms and p99 ≤ 200 ms. These limits are enforced by `Tools\Invoke-StateTraceVerification.ps1` and the dispatcher harness (`-QueueDelayWarningMs`/`-QueueDelayCriticalMs`). Log any guard failure in Plan A + Task Board updates.
- `InterfaceSyncTiming.StreamCloneDurationMs` p95 < 75 ms and event count equals processed hosts (37 for BOYO/WLLS corpus); deviations require a Plan A + TaskBoard update.
- `InterfaceSyncTiming.StreamDispatchDurationMs` and dispatcher harness `DispatcherDurationMs` remain within 2x historical baselines (see 2025-10-15 entries in `docs/StateTrace_Consolidated_Plans.md`); document any regressions.
- Gates are tracked in `docs/telemetry/Automation_Gates.md#plan-a`; update that file if thresholds change.
- Routing telemetry + dispatcher evidence copied into the release telemetry bundle (see Plan E ST-E-007 / Plan G ST-G-007) before any candidate build proceeds.

## References & history
- Historical narrative: `docs/StateTrace_Consolidated_Plans.md` (2025-10-15 InterfaceSyncTiming and dispatcher harness entries).
- Automation references: `docs/CODEX_PLAN_AUTOMATION_MATRIX.md`, `docs/CODEX_RUNBOOK.md`, `docs/CODEX_SHARED_CACHE_DIAGNOSTICS.md`.
- UI + operator guidance: `docs/StateTrace_Operators_Runbook.md`, `docs/UI_Smoke_Checklist.md`, `docs/plans/PlanD_FeatureExpansion.md`.














